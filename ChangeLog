2008-12-30 14:10  xavier

	* [r4846] src/grid/derivatives.F90, src/grid/mesh.F90,
	  src/grid/mesh_function_inc.F90, src/grid/ob_interface.F90,
	  src/hamiltonian/rkb_projector.F90, src/ions/dynamics.F90,
	  src/states/restart.F90: Removed some unused variables.

2009-01-02 17:18  acastro

	* [r4847] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/states.F90: Separated
	  the calculations of the density matrix, which is transferred
	  to mesh_function module, from its printout. Also, now it does not
	  break in the parallel case as before.

2009-01-05 10:41  marques

	* [r4848] libxc/DONE, libxc/TODO, libxc/src/Makefile.am,
	  libxc/src/gga_x_bayesian.c: Added a new form for the exachange
	  enhancement factor that comes from a bayesian best fit procedure

2009-01-05 10:48  marques

	* [r4849] src/grid/mesh_function_inc.F90, src/xc/xc.F90: Needed an
	  #ifdef to compile

2009-01-05 12:36  marques

	* [r4850] src/main/one_shot.F90, src/system/v_ks.F90,
	  src/system/xc_OEP_inc.F90: Now also orbital functionals work in
	  the one_shot mode

2009-01-05 20:48  acastro

	* [r4851] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/states.F90: o Removed
	  some problems that appeared when computing the density
	  matrix in parallel.
	  
	  o Now the computation of the density matrix uses the
	  cube_function_m
	  module, which makes it easier, and hopefully easier to generalize
	  to
	  higher dimension.

2009-01-08 23:31  dstrubbe

	* [r4852] src/basic/loct_parser.F90, src/ions/simul_box.F90,
	  src/math/fft.F90, src/utils/dielectric_function.F90: A point of
	  spelling: replaced "can not" with "cannot"

2009-01-09 16:11  xavier

	* [r4853] src/grid/grid.F90, src/grid/mesh_function_inc.F90,
	  src/grid/par_vec.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90,
	  src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/species_pot.F90, src/include/global.h,
	  src/main/casida.F90, src/main/casida_inc.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/static_pol.F90,
	  src/main/unocc.F90, src/main/unocc_inc.F90,
	  src/opt_control/defstates.F90, src/opt_control/opt_control.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/solver_3D.F90,
	  src/poisson/solver_fft.F90, src/poisson/solver_multigrid.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/restart.F90, src/states/restart_inc.F90,
	  src/states/states.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/td/cpmd.F90,
	  src/td/cpmd_inc.F90, src/td/ob_rti.F90, src/td/td.F90,
	  src/td/td_calc.F90, src/td/td_init.F90, src/td/td_rti.F90,
	  src/td/td_write.F90, src/xc/axc.F90, src/xc/vxc.F90: Renamed gr%m
	  to gr%mesh.

2009-01-09 16:19  xavier

	* [r4854] src/hamiltonian/epot.F90, src/scf/eigen.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90,
	  src/states/linear_response.F90, src/states/states.F90,
	  src/states/states_calc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/td/cpmd.F90, src/td/td.F90:
	  Renamed wfs_are_real to states_are_real (the same for
	  wfs_are_complex).

2009-01-09 17:03  xavier

	* [r4855] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/gcm.F90,
	  src/main/unocc.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_mg_inc.F90, src/scf/eigen_plan_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/subspace_inc.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/linear_solver_inc.F90, src/td/cpmd_inc.F90,
	  src/td/ob_rti.F90, src/td/td_calc.F90: * Renamed hpsi to
	  hamiltonian_apply.

2009-01-09 22:07  xavier

	* [r4856] src/basic/global.F90, src/include/global.h,
	  src/td/ob_mem.F90: Now M_ONE and M_ZERO are macros. This should
	  allow the compiler to
	  optimize more the code.

2009-01-10 12:22  xavier

	* [r4857] src/basic/datasets.F90, src/basic/multicomm.F90,
	  src/basic/units.F90, src/grid/curv_briggs.F90,
	  src/grid/curv_gygi.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/double_grid.F90, src/grid/grid.F90,
	  src/grid/io_function.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/grid/scalar_mesh.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/scf_tol.F90, src/hamiltonian/species_pot.F90,
	  src/ions/dynamics.F90, src/ions/geometry.F90,
	  src/ions/simul_box.F90, src/ions/xyz_adjust.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/main.F90,
	  src/main/phonons_fd.F90, src/main/run.F90,
	  src/main/static_pol.F90, src/main/test.F90, src/main/unocc.F90,
	  src/math/fftw3.F90, src/math/ode_solver_inc.F90,
	  src/math/root_solver.F90, src/math/sparskit_inc.F90,
	  src/math/tdfunction.F90, src/opt_control/defstates.F90,
	  src/opt_control/filters.F90, src/opt_control/iter.F90,
	  src/opt_control/parameters.F90, src/opt_control/read.F90,
	  src/opt_control/target.F90, src/poisson/poisson.F90,
	  src/poisson/solver_3D.F90, src/poisson/solver_fft.F90,
	  src/poisson/solver_multigrid.F90, src/scf/eigen.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90, src/scf/scf.F90,
	  src/species/ps.F90, src/species/species.F90, src/states/elf.F90,
	  src/states/mix.F90, src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_calc.F90,
	  src/states/states_kpoints.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/vdW.F90, src/system/exponential.F90,
	  src/system/linear_solver.F90, src/system/output_h_sys.F90,
	  src/system/pert.F90, src/system/preconditioners.F90,
	  src/system/v_ks.F90, src/system/xc_OEP.F90, src/td/cpmd.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/pes.F90,
	  src/td/pes_rc.F90, src/td/spectrum.F90, src/td/td.F90,
	  src/td/td_init.F90, src/td/td_rti.F90, src/td/td_write.F90,
	  src/utils/broad.F90, src/utils/dielectric_function.F90,
	  src/utils/harmonic_spectrum.F90, src/utils/phonon_spectrum.F90,
	  src/utils/xyzanim.F90, src/xc/functionals.F90, src/xc/xc.F90:
	  Renamed check_inp to datasets_check.

2009-01-10 16:07  xavier

	* [r4858] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/casida.F90,
	  src/main/gcm.F90, src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/run.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/opt_control/finalcheck.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/read.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver.F90, src/system/linear_solver_inc.F90,
	  src/system/output_h.F90, src/system/output_h_sys.F90,
	  src/system/pert_inc.F90, src/system/preconditioners_inc.F90,
	  src/system/system.F90, src/system/v_ks.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/td/cpmd_inc.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/td.F90, src/td/td_calc.F90, src/td/td_init.F90,
	  src/td/td_rti.F90, src/td/td_write.F90: Renamed the hamiltonian
	  object from h to hm.

2009-01-10 20:08  xavier

	* [r4859] src/basic/profiling.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/eigen.F90, src/scf/lcao.F90, src/scf/scf.F90,
	  src/td/td.F90: Moved some profiling variables to their own
	  modules.

2009-01-10 20:38  xavier

	* [r4860] src/grid/derivatives_inc.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/grid/submesh.F90,
	  src/grid/submesh_inc.F90: Renamed vp%p to vp%npart.

2009-01-11 10:38  xavier

	* [r4861] configure.ac: Removed some whitespaces that might produce
	  problems with autoconf.

2009-01-11 22:28  xavier

	* [r4862] src/main/main.F90, src/main/run.F90: Renamed run_prog_m
	  to run_m.

2009-01-13 08:24  marques

	* [r4863] configure.ac, src/beak/beak.h: Some compilers (pathscale)
	  did not implement SSE, even if the header
	  file is available. These changes now allow octopus to compile in
	  milipeia
	  
	  BTW, Xavier, the file operate_ri_vec.c gives lots of warnings,
	  and the
	  code accesses directly the type __m128d, which the manual says
	  one
	  should not do... is it possible to clean it?

2009-01-13 10:22  xavier

	* [r4864] src/beak/operate_ri_vec.c: The SSE code was doing some
	  ilegal (but correct) pointer castings.

2009-01-14 11:39  xavier

	* [r4865] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/main/phonons_fd.F90,
	  src/main/run.F90, src/main/static_pol.F90, src/scf/scf.F90,
	  src/system/v_ks.F90, src/td/td.F90, src/td/td_rti.F90: Now the
	  hamiltonian stores the total potential, this saves time and
	  simplifies the routine to apply the hamiltonian. The price to pay
	  is
	  that hamiltonian_update_potential must be called each time
	  hm%vpsl or
	  hm%vhxc are changed.

2009-01-14 23:21  xavier

	* [r4866] src/hamiltonian/Makefile.am,
	  src/hamiltonian/em_field.F90, src/hamiltonian/em_field_inc.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Added a new object,
	  em_field_t, that stores an electromagnetic field
	  and can apply it over a wave-function.

2009-01-15 18:03  xavier

	* [r4867] src/hamiltonian/Makefile.am, src/hamiltonian/lasers.F90:
	  Added a function to generate a em_field from a laser.

2009-01-15 18:55  xavier

	* [r4868] src/hamiltonian/em_field.F90,
	  src/hamiltonian/em_field_inc.F90, src/hamiltonian/lasers.F90:
	  Removed the uniform vector potential from em_field. Since the
	  idea is
	  to finally handle it through a phase, there is no need to have
	  it.

2009-01-15 20:07  xavier

	* [r4869] src/hamiltonian/lasers.F90: A couple of line were too
	  long.

2009-01-16 10:07  acastro

	* [r4870] src/opt_control/opt_control.F90: The code did not compile
	  if the newuoa library was present, due to the
	  change of name of the hamiltonian variable.

2009-01-16 11:38  xavier

	* [r4871] src/hamiltonian/em_field.F90,
	  src/hamiltonian/em_field_inc.F90: Added a function to apply an
	  em_field to a single function.

2009-01-17 02:53  dstrubbe

	* [r4872] src/states/states_dim.F90, src/states/states_kpoints.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90: *) Made a
	  preprocessor variable for the name of the output directory for
	  kdotp and em_resp
	  *) Added a function kpoint_index that tells what number k-point
	  (without spin) a given ik refers to
	  *) Made kdotp use states_dim_get_spin_index and kpoint_index in
	  naming output files

2009-01-17 03:20  dstrubbe

	* [r4873] src/main/run.F90, src/main/static_pol.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/vdW.F90: Renamed pol_lr module to em_resp for
	  consistently with the filename.

2009-01-17 21:12  xavier

	* [r4874] src/td/td_rti.F90: Initial implementation of the Visscher
	  propagator, for the moment it
	  can only propagate a time independent hamiltonian.

2009-01-17 22:30  xavier

	* [r4875] src/td/td_rti.F90: Now the Visscher propagator works for
	  time dependent Hamiltonians.
	  
	  This is a nice scheme that only requires two real applications of
	  the
	  Hamiltonian per time step.

2009-01-17 23:30  xavier

	* [r4876] src/td/td_rti.F90,
	  testsuite/real_time/07-visscher.01-gs.inp,
	  testsuite/real_time/07-visscher.02-td.inp,
	  testsuite/real_time/07-visscher.test: * Added a test for the
	  visscher propagator. The results agree with
	  other propagators.

2009-01-18 09:02  dstrubbe

	* [r4877] src/main/casida.F90, src/opt_control/defstates.F90,
	  src/opt_control/target.F90, src/states/restart.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/raman.F90,
	  src/sternheimer/vdW.F90, src/td/td.F90: *) Combined routine
	  "read_wfs" which appeared in several copies in the Sternheimer
	  modules with the almost identical routine
	  "restart_look_and_read." Now an error will be generated when no
	  wavefunctions are found, which was not the case in most places
	  from which "restart_look_and_read" was called.
	  
	  I notice that Raman and phonons explicitly set the wavefunctions
	  to be real. Why is this? Shouldn't they be complex for a periodic
	  system?

2009-01-18 09:06  xavier

	* [r4878] src/td/td_rti.F90: * Now the exponential midpoint rule is
	  used to propagate the initial
	  imaginary part in the Visscher propagator.
	  * Some optimizations.

2009-01-20 01:39  dstrubbe

	* [r4879] src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90: Now raman and phonon calculations
	  don't require ground-state wavefunctions to be real.

2009-01-20 02:40  acastro

	* [r4880] src/opt_control/defstates.F90,
	  src/opt_control/target.F90: Bug fix; the optimal control tests
	  were failing since the change in
	  the "restart_look_and_read" routine.

2009-01-20 20:58  dstrubbe

	* [r4881] src/main/casida.F90, src/states/restart.F90,
	  src/td/td.F90: Fixed the problem Alberto pointed out in two other
	  places too: the specify_dir optional argument is not used, since
	  in the old version of the routine the corresponding argument was
	  ignored.

2009-01-20 21:55  dstrubbe

	* [r4882] src/include/global.h, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/raman.F90, src/sternheimer/vdW.F90: Created
	  preprocessor constants in global.h for each Sternheimer routine's
	  restart directory, so those that use other routines' restart info
	  can be sure to be getting it from the same place it was put. This
	  may not be the best way to do it; let me know if you have a
	  better suggestion.

2009-01-20 22:18  dstrubbe

	* [r4883] src/sternheimer/em_resp.F90: Fix to last commit in which
	  I forgot to replace RESTART_DIR in em_resp.F90, which had caused
	  a test to fail.

2009-01-21 00:47  dstrubbe

	* [r4884] src/sternheimer/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/raman.F90: *)
	  Reorganized kdotp and em_resp modules so that you first do a
	  kdotp run, then do an em_resp run. This way it is much easier to
	  do multiple frequencies, and removes a lot of duplicated code.
	  The calculation of alpha and beta will occur within the em_resp
	  run even for a periodic system.
	  *) Moved calculation of polarizability of periodic system to
	  em_resp_calc
	  *) Added variable to force calculation of alpha and beta without
	  kdotp wfns, as though it were a finite system.
	  *) Repeated "use" statement in raman.F90 removed.

2009-01-21 01:15  dstrubbe

	* [r4885] src/sternheimer/em_resp.F90: *) A small fix to a compiler
	  portability issue (can't use NDIM in declaration)
	  *) "Info: calculating response for direction..." is only printed
	  when it is necessary to do that calculation.

2009-01-21 14:35  acastro

	* [r4886] src/td/td_rti.F90: Bug fix; the code was crashing when
	  attempting to perform an
	  "associated" call over an uninitialized pointer.

2009-01-21 15:32  marques

	* [r4887] src/poisson/poisson.F90, src/poisson/solver_1D.F90,
	  src/poisson/solver_fft.F90: Added the possibility of changing the
	  parameter a (v=1/sqrt(a^2+x^2) in
	  the soft coulomb interaction in 1d. Alberto, was it you who
	  implemented
	  the periodic FFT solver in 1D? Can you please check if the
	  formula I
	  implemented is correct?

2009-01-21 17:56  acastro

	* [r4888] external_libs/newuoa/Makefile.am,
	  external_libs/newuoa/bigden.f90, external_libs/newuoa/biglag.f90,
	  external_libs/newuoa/newuoa.f90,
	  external_libs/newuoa/newuoa_mod.f90,
	  external_libs/newuoa/newuob.f90, external_libs/newuoa/trsapp.f90,
	  external_libs/newuoa/update.f90, src/common-rules.make,
	  src/opt_control/opt_control.F90: I put together all the
	  subroutines of the newuoa library into one
	  module; that way their names cannot collide with other parts of
	  the
	  code (except for only one public entity, and only if the module
	  is
	  used).

2009-01-22 03:46  dstrubbe

	* [r4889] src/sternheimer/sternheimer.F90,
	  src/system/linear_solver.F90, src/td/ob_rti.F90,
	  testsuite/linear_response/02-h2o_pol_lr.test: *) Changed default
	  Sternheimer solver to QMR instead of bicgstab.
	  *) By default preorthogonalization of wavefunctions against
	  occupied states is now done at the start of each Sternheimer SCF
	  cycle.
	  *) Changed test reference data since these alter results
	  slightly.
	  QMR and preorthogonalization make calculations converge better in
	  general, though they may take more time. This is why I have made
	  them default. For kdotp in particular the calculation does not
	  converge at all without these settings.
	  *) A few typographic issues in ob_rti.F90

2009-01-22 07:12  acastro

	* [r4890] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90: Added a subroutine that provides
	  the upper and lower bounds of the
	  parameters that define the control functions for OCT.

2009-01-22 15:48  xavier

	* [r4891] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/vdW.F90: A
	  function name was too long (stupid fortran limitation).

2009-01-23 23:20  dstrubbe

	* [r4892] src/states/restart.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90: *) Reading ground-state wavefunctions
	  must come before reading linear-response wavefunctions in em_resp
	  *) Slight improvement to formatting of warnings in kdotp and
	  em_resp
	  *) Renamed asserted variables to more meaningful things in
	  restart
	  *) Made output message give more info in restart

2009-01-25 09:22  xavier

	* [r4893] src/basic/calc_mode.F90, src/grid/mesh.F90,
	  src/main/Makefile.am, src/main/main.F90, src/main/run.F90,
	  src/states/states.F90: Added a new calculation mode: "memory".
	  
	  It tells you how much memory octopus will require to run.

2009-01-25 09:44  xavier

	* [r4894] src/main/memory.F90: Forgot to add a file.

2009-01-25 11:39  acastro

	* [r4895] src/td/td.F90, src/td/td_init.F90: All tests in
	  testsuite/real_time directory were failing, due to bad
	  usage of intent(out) in td_init.

2009-01-25 22:32  acastro

	* [r4896] src/opt_control/Makefile.am,
	  src/opt_control/defstates.F90, src/opt_control/filters.F90,
	  src/opt_control/initst.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_constants.F90,
	  src/opt_control/target.F90: The definition of the initial state
	  (for the OCT runs) is done now in
	  its own module.

2009-01-26 09:24  marques

	* [r4897] src/main/unocc.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/lcao_inc.F90: *) As discussed
	  in the mailing list, now unocc goes through all states,
	  and not only the unoccupied ones
	  *) When verbose output is on, the eigensolver does not output the
	  progress bar -- the output was a bit messy when running from a
	  terminal

2009-01-26 09:29  marques

	* [r4898] src/main/unocc.F90: Sorry, forgot a stop

2009-01-26 09:30  marques

	* [r4899] src/scf/lcao_inc.F90: ...and a print... I am really
	  sloppy ;))

2009-01-26 13:20  acastro

	* [r4900] src/scf/eigen.F90: The use of an optional variable was
	  causing the code to break whenever
	  that variable was not present.

2009-01-26 21:12  acastro

	* [r4901] src/basic/Makefile.am, src/basic/loct.F90,
	  src/basic/loct_inc.F90, src/states/states.F90, src/td/td_rti.F90:
	  Added a routine, loct_copy_pointer, that permits to copy the
	  arrays
	  defined as pointers in derived data types. There are quite a few
	  places in the code where this has to be done, and it is annoying
	  to do
	  the same every time (I changed a couple of places, but there are
	  some
	  more around).
	  
	  I am not sure, however, if Fortran has a smarter way to do this.

2009-01-29 20:35  dstrubbe

	* [r4902] src/main/main.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90: *) Compiler flags is no
	  longer truncated to 80 characters at top of output, so you can
	  see the whole string
	  *) A few corrections to comments

2009-01-30 04:10  dstrubbe

	* [r4903] src/basic/io.F90, src/grid/derivatives.F90,
	  src/grid/scalar_mesh.F90, src/include/global.h,
	  src/ions/geometry.F90, src/ions/solids.F90,
	  src/main/one_shot.F90, src/main/unocc.F90, src/scf/scf.F90,
	  src/states/states_kpoints.F90: *) Variable reference stated that
	  if no k-points blocks were provided, the default was the gamma
	  point, but this was not actually implemented and instead an error
	  message was written. Now the default has been implemented.
	  *) When there are atoms that are too close, before exiting, the
	  program writes the geometry to static/geometry.xyz so you can
	  actually see what the problem is.
	  *) All instances of "static" I could find, specifying the output
	  directory, have been replaced by a preprocessor constant
	  STATIC_DIR to make sure they are all really the same.
	  *) Some miscellaneous formatting and corrections to comments.

2009-01-30 13:18  acastro

	* [r4904] src/grid/scalar_mesh.F90, src/main/unocc.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90: o
	  Added a '/' after the STATIC_DIR, recently introduced by David,
	  in a
	  couple of places where it was missing.
	  
	  o Some maintenance changed in the opt_control directory (removal
	  of
	  unnecessary variables, etc.)

2009-01-30 14:38  xavier

	* [r4905] src/grid/mesh_init.F90, src/grid/nl_operator.F90: To save
	  memory, now the mesh%resolution array is only allocated if
	  multiresolution is actually used.

2009-01-30 15:31  xavier

	* [r4906] src/grid/mesh.F90, src/ions/simul_box.F90,
	  src/main/unocc_inc.F90: * Whether resolution is allocated or not
	  is now considered by memory run mode.
	  * Fixed an out of bounds in the calculation of matrix elements.

2009-01-31 11:21  xavier

	* [r4907] src/basic/Makefile.am, src/basic/distributed.F90,
	  src/basic/mpi_lib.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/fourier_space.F90,
	  src/grid/grid.F90, src/grid/gridhier.F90, src/grid/multigrid.F90,
	  src/grid/ob_interface.F90, src/grid/stencil.F90,
	  src/grid/stencil_cube.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_starplus.F90, src/grid/stencil_variational.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/rkb_projector.F90, src/include/global.h,
	  src/ions/crystal.F90, src/ions/geometry.F90,
	  src/ions/simul_box.F90, src/ions/vibrations.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/math/Makefile.am, src/math/fftw3.F90, src/math/lalg_adv.F90,
	  src/math/math.F90, src/math/ode_solver.F90,
	  src/math/root_solver.F90, src/math/solvers.F90,
	  src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/filters.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/poisson/conj_grad.F90,
	  src/poisson/corrections.F90, src/poisson/solver_isf.F90,
	  src/poisson/solver_multigrid.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/species/atomic.F90,
	  src/species/logrid.F90, src/species/ps.F90,
	  src/species/ps_cpi.F90, src/species/ps_cpi_file.F90,
	  src/species/ps_fhi.F90, src/species/ps_fhi_file.F90,
	  src/species/ps_hgh.F90, src/species/ps_in_grid.F90,
	  src/species/ps_psf.F90, src/species/ps_psf_file.F90,
	  src/species/ps_upf.F90, src/species/species.F90,
	  src/states/elf.F90, src/states/excited_states.F90,
	  src/states/linear_response.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/restart.F90, src/states/smear.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/vdW.F90, src/system/energy.F90,
	  src/system/exponential_split.F90, src/system/output_h_sys.F90,
	  src/system/system.F90, src/system/xc_OEP_kernel.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/ob_src.F90,
	  src/td/pes.F90, src/td/spectrum.F90, src/td/td_write.F90,
	  src/utils/broad.F90, src/utils/cross_section.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90:
	  * Included the possibility of doing a space (memory) profiling in
	  Octopus.

2009-01-31 19:51  xavier

	* [r4908] src/sternheimer/sternheimer_inc.F90: The resulting vector
	  after solving the Sternheimer equation has to be
	  re-orthogonalized, this greatly increases convergency (we had
	  this
	  before and it was removed at some point).

2009-01-31 22:58  xavier

	* [r4909] src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver_inc.F90: Orthogonalizing the initial
	  search direction in the bigcstab
	  algorithms improves considerably the convergence rate of the
	  algorithm.

2009-02-01 11:23  xavier

	* [r4910] src/states/linear_response_inc.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver_inc.F90: * Fixed a problem with the
	  bicgstab solver introduced in my last commit.
	  * Some code cleaning in sternheimer.

2009-02-01 11:59  xavier

	* [r4911] src/system/linear_solver_inc.F90: Remove unnecessary
	  initializations to zero in the bicgstab solver.

2009-02-01 13:57  xavier

	* [r4912] src/sternheimer/sternheimer_inc.F90: Unit conversion was
	  missing in Sternheimer output.

2009-02-01 14:21  xavier

	* [r4913] src/hamiltonian/scf_tol.F90: Changed the default value of
	  the AdaptiveTolFactor variable to 0.9.
	  This seems to give the best results.

2009-02-01 21:04  xavier

	* [r4914] src/sternheimer/em_resp.F90: Another unit conversion
	  missing.

2009-02-03 10:24  xavier

	* [r4915] src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/sternheimer/phonons_lr.F90, src/system/pert_inc.F90: Added
	  the possibility of precalculating the ionic potential and
	  storing it instead of calculating it every time, this is useful
	  for
	  the calculation of vibrational modes where the calculation of the
	  dynamical matrix consumes considerable time.

2009-02-03 13:44  xavier

	* [r4916] src/ions/vibrations.F90, src/sternheimer/phonons_lr.F90:
	  * The dynamical matrix is now printed by components.
	  * One expectation value does not have to be calculated.

2009-02-03 14:43  xavier

	* [r4917] src/basic/profiling.F90: Memory profiling produced huge
	  files, now only allocations that
	  actually change the memory footprint of the program are reported.

2009-02-03 16:17  xavier

	* [r4918] src/sternheimer/phonons_lr.F90: The symmetry of the
	  dynamical matrix is now take into account.

2009-02-03 20:25  acastro

	* [r4919] src/opt_control/parameters.F90: Corrected some little bug
	  in the use of mixing schemes for OCT runs.

2009-02-04 02:30  dstrubbe

	* [r4920] src/hamiltonian/epot_inc.F90, src/scf/eigen.F90,
	  src/states/states.F90: A few trivial changes.

2009-02-04 13:01  marques

	* [r4921] src/main/casida.F90, src/main/one_shot.F90,
	  src/states/states.F90, src/sternheimer/sternheimer.F90,
	  src/system/v_ks.F90, src/xc/vxc.F90: Cleaned a bit the generation
	  of the total density that goes in the
	  calculation of vxc and fxc.

2009-02-04 13:07  marques

	* [r4922] src/sternheimer/em_resp_calc_inc.F90: The evaluation of
	  kxc was not taking non-linear core corrections into account

2009-02-04 17:59  xavier

	* [r4923] src/sternheimer/phonons_lr.F90, src/system/pert.F90,
	  src/system/pert_inc.F90: The <0|2|0> term of the dynamical matrix
	  now is calculated directly
	  instead of using pert_expectation_value, the previous way was
	  very
	  slow (80% of computer time).

2009-02-05 08:14  xavier

	* [r4924] src/scf/scf.F90: The ConvRelForce criterion was not well
	  defined, its value was always
	  1.0. So I removed it and renamed ConvAbsForce to ConvForce.

2009-02-06 00:23  dstrubbe

	* [r4925] libxc/m4/acx.m4, m4/fortran.m4: The macro that checks for
	  "very long lines" used a test program with a line that was very
	  long, but still not nearly so long as some lines generated by the
	  ALLOCATE preprocessor macro in the code. The PGI 8.0-1 Fortran
	  compiler passed that test in the configure script since it could
	  handle 140 characters in a line, but could not handle 270
	  characters. I approximately tripled the length of that line in
	  the test program to 433 characters, so that now PGI is considered
	  not to accept long lines.

2009-02-06 09:59  xavier

	* [r4926] src/hamiltonian/Makefile.am,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/hamiltonian/scissor.F90,
	  src/hamiltonian/scissor_inc.F90: Now a scissor operator can be
	  included in the hamiltonian. (still not
	  tested).

2009-02-06 11:07  xavier

	* [r4927] src/hamiltonian/scissor_inc.F90: Some fixed in the
	  scissor operator.

2009-02-06 17:54  dstrubbe

	* [r4928] src/hamiltonian/epot.F90, src/scf/scf.F90,
	  src/states/smear.F90: *) The single-point Berry's phase dipole
	  calculation gives an error if the smearing is not semiconducting,
	  since otherwise it is unclear (or maybe impossible) to construct
	  a Slater determinant.
	  *) The quantum of polarization is used to reduce the dipole (in
	  the periodic case) to the smallest magnitude, for ease of
	  analysis.

2009-02-06 23:30  xavier

	* [r4929] src/basic/loct_inc.F90: Pointer copy routines now use a
	  forall loop.

2009-02-06 23:31  xavier

	* [r4930] src/beak/operate_ri.c, src/poisson/solver_multigrid.F90:
	  Gauss seidel relaxation is now done by a C routine.

2009-02-06 23:46  xavier

	* [r4931] configure.ac, src/beak/beak.h: The changes in the macros
	  made by Miguel caused that SSE was not used
	  in any compiler. Miguel, if compilation fails in Milipeia can you
	  send
	  the error so we can write a proper fix?

2009-02-07 09:59  xavier

	* [r4932] src/beak/operate_ri.c, src/grid/multigrid.F90,
	  src/grid/multigrid_inc.F90, src/poisson/solver_multigrid.F90:
	  Several improvements in the multigrid code.

2009-02-07 11:35  xavier

	* [r4933] src/hamiltonian/scissor_inc.F90, src/td/td.F90,
	  src/td/td_init.F90: Added the option of adding a scissor operator
	  to the Hamiltonian
	  during time propagation. Still testing is needed.

2009-02-07 17:42  xavier

	* [r4934] src/td/td.F90: The phase of the ground state orbitals for
	  the scissor operator was
	  missing. Now the scissor operator works properly for fixed atoms.

2009-02-08 17:16  xavier

	* [r4935] src/sternheimer/em_resp.F90: Fixed a serious memory leak
	  in sternheimer when several frequencies
	  were calculated (lr wave-functions were allocated again for each
	  frequency).

2009-02-08 18:08  xavier

	* [r4936] testsuite/linear_response/02-h2o_pol_lr.test: My last
	  commit changed a bit the results of a test.

2009-02-08 19:11  xavier

	* [r4937] src/sternheimer/sternheimer_inc.F90: As discussed with
	  David, now only one preorthogonalization (before
	  calculating the density) is done.

2009-02-09 17:57  acastro

	* [r4938] src/basic/messages.F90, src/opt_control/Makefile.am,
	  src/opt_control/check_input.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_constants.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/read.F90: Added documentation for some variables,
	  and some comments in the
	  code. Also, some re-naming and maintenance changes in the OCT
	  part.

2009-02-09 21:45  dstrubbe

	* [r4939] src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/ions/geometry.F90, src/sternheimer/em_resp.F90: *)
	  Implemented calculation of Born effective charges, from the
	  derivative of the ionic forces with respect to electric
	  perturbation. Still in testing.
	  *) Some tweaks to output in em_resp.
	  *) In em_resp, renamed "dir" variable to "idir" to reduce
	  confusion between direction and directory.

2009-02-09 22:40  acastro

	* [r4940] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: A couple of problems caught by my
	  compiler: ".eq." should not be used
	  for booleans (use ".eqv." instead), some intent(in) should be
	  intent(inout), and one line too long.

2009-02-11 02:23  dstrubbe

	* [r4941] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: *) A bit of cleaning up
	  *) Born charges now given as magnitude and phase rather than real
	  and imaginary part, which seems more useful

2009-02-11 20:39  dstrubbe

	* [r4942] src/hamiltonian/epot.F90: I previously made the
	  calculation in a periodic system fail if semiconducting smearing
	  was not used, because my routine to
	  calculate the dipole could not handle other smearing schemes. But
	  I shouldn't have made it impossible to do these runs;
	  it's just that the dipole is not accurate. Now just a warning is
	  written.

2009-02-11 23:57  xavier

	* [r4943] src/grid/io_function_inc.F90: Bugfix: Units were not
	  considered by dx output.

2009-02-12 05:06  dstrubbe

	* [r4944] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: *) Now using minus frequency as well
	  for non-zero frequencies for Born effective charges.
	  *) The acoustic sum rule is now checked and the degree of
	  violation output, before correcting it.
	  *) I think there was a factor of st%d%kweights(ik) missing for
	  calculation of regular forces in the non-local pseudopotential
	  part

2009-02-12 05:19  dstrubbe

	* [r4945] share/util/display_mesh_index.gp,
	  src/sternheimer/em_resp.F90: *) Removed a debugging statement
	  accidentally left in my last commit,
	  which I think caused a compilation failure
	  *) Made the display gnuplot script work

2009-02-12 05:28  dstrubbe

	* [r4946] src/grid/io_function.F90, src/hamiltonian/epot_inc.F90,
	  src/ions/simul_box.F90: *) Actually I think the problem was
	  breaking a line in an ASSERT macro
	  *) Added an error message when you don't specify OutputHow
	  because previously it just did nothing if you hadn't specified
	  the output method
	  *) A little formatting

2009-02-12 09:08  acastro

	* [r4947] src/hamiltonian/epot_inc.F90: Another problem with long
	  lines (even if the ASSERT macro is broken
	  into several lines, it may happen that the argument is already
	  too
	  long).

2009-02-13 03:33  dstrubbe

	* [r4948] src/hamiltonian/epot_inc.F90,
	  src/sternheimer/em_resp.F90: A fix for Born charges at zero
	  frequency.

2009-02-13 10:52  acastro

	* [r4949] src/basic/command_line.F90, src/basic/getopt_f.c,
	  src/td/spectrum.F90, src/utils/harmonic_spectrum.F90: o Repaired
	  the calculation of the harmonic spectrum from the
	  acceleration, which was broken for low dimensional systems (the
	  file
	  was not properly read).
	  
	  o I introduced another mode for the oct-harmonic-spectrum
	  utility: for
	  each multiple of the fundamental frequency, an algorithm looks
	  for the
	  peak of the spectrum in its vicinity. The program then these
	  maxima
	  only.

2009-02-14 00:26  dstrubbe

	* [r4950] src/grid/grid.F90, src/grid/gridhier_inc.F90,
	  src/grid/multigrid.F90, src/grid/multigrid_inc.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90: A while
	  ago, gr%m was renamed to gr%mesh, so as not to have a
	  single-letter variable name. I continued this by changing m to
	  mesh in the multigrid and fine meshes, and some functional
	  arguments.

2009-02-14 14:34  acastro

	* [r4951] src/poisson/solver_multigrid.F90,
	  src/system/preconditioners_inc.F90: Some "m" that still needed to
	  be changed to "mesh".

2009-02-14 15:18  acastro

	* [r4952] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/propagation.F90: o The use of an optional
	  argument without checking if it is really
	  present caused a segfault.
	  
	  o Removal of some unused variables.

2009-02-15 11:08  acastro

	* [r4953] src/basic/command_line.F90, src/basic/getopt_f.c,
	  src/opt_control/target.F90, src/td/spectrum.F90,
	  src/utils/harmonic_spectrum.F90: Cleaned up the harmonic spectrum
	  calculation, which I had messed up a
	  little.

2009-02-15 18:33  acastro

	* [r4954] src/opt_control/initst.F90,
	  src/opt_control/opt_control.F90, src/opt_control/parameters.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90:
	  Improved the printing of the Fourier transform of the control
	  functions used for QOCT runs. In the way, some unimportant
	  details
	  were fixed.

2009-02-15 20:11  xavier

	* [r4955] src/grid/hypercube.F90: Included routines to convert from
	  an hypercubical grid to a linear
	  array and back. These routines were written by Nicole Helbig and
	  this
	  is a copy of her original code, they are not used yet.

2009-02-15 20:47  xavier

	* [r4956] src/grid/Makefile.am, src/grid/hypercube.F90: Moved
	  hypercube routines inside a module and changed the code to
	  octopus style.

2009-02-15 21:42  xavier

	* [r4957] src/sternheimer/em_resp.F90: Corrected the calculation of
	  circular dichroism.

2009-02-16 00:00  dstrubbe

	* [r4958] src/sternheimer/em_resp.F90: Now the tensor combinations
	  of the hyperpolarizability for hyper-Rayleigh scattering (HRS)
	  are calculated, for the VV and HV polarizations.

2009-02-16 08:22  xavier

	* [r4959] src/sternheimer/em_resp.F90: Changed the message
	  displayed for circular dichroism.

2009-02-16 09:00  xavier

	* [r4960] src/grid/Makefile.am, src/grid/hypercube.F90,
	  src/grid/index.F90, src/grid/mesh.F90, src/grid/mesh_init.F90,
	  src/ions/simul_box.F90: Defined a new boxshape: hypercube
	  (actually an hyperparallelepiped).
	  This is to introduce arbitrary dimensions in octopus.

2009-02-16 15:45  xavier

	* [r4961] src/grid/hypercube.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/nl_operator.F90,
	  src/ions/simul_box.F90: Now the hypercubic grid is working (up to
	  3d).

2009-02-16 23:17  xavier

	* [r4962] src/grid/multigrid.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/math/math_inc.F90,
	  src/system/pert_inc.F90: Some fixes required for running with
	  MAX_DIM = 4.

2009-02-17 17:27  acastro

	* [r4963] src/opt_control/check_input.F90: For QOCT runs, mask-type
	  absorbing boundaries were not allowed;
	  however in certain cases they should be allowed. I corrected the
	  check
	  in order to allow those cases.

2009-02-18 03:23  dstrubbe

	* [r4964] src/hamiltonian/species_pot.F90, src/ions/Makefile.am,
	  src/ions/dynamics.F90, src/ions/interaction.F90,
	  src/ions/ion_dynamics.F90, src/ions/ion_interaction.F90: *)
	  Changed the name of a misleadingly labeled routine in its
	  push_sub() command
	  *) Changed the names of two files to correspond to the names of
	  their modules

2009-02-18 15:21  nitsche

	* [r4965] src/grid/mesh.F90, src/grid/mesh_init.F90: * Fixed the
	  transport mode. Problems were:
	  - MAX_DIM<==>sb%dim related stuff
	  - optimization of the mesh in blocks does not work with the
	  transport mode. MeshBlockSizeXY and MeshBlockSizeXY must be both
	  1.
	  - a non-initialized pointer
	  There is still a problem with MPI, so I will not switch on the
	  tests yet...

2009-02-19 06:18  xavier

	* [r4966] src/hamiltonian/epot_inc.F90: Bugfix: Now the epot_force
	  uses complex values, but the MPI routines
	  where still using MPI_FLOATs. This caused the forces to be wrong
	  in
	  parallel runs.

2009-02-19 07:01  xavier

	* [r4967] src/hamiltonian/hamiltonian.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/states/states_kpoints.F90: More fixes
	  for MAX_DIM = 4.

2009-02-19 07:44  xavier

	* [r4968] src/sternheimer/em_resp.F90: A repeated + sign caused
	  problems with some compilers.

2009-02-19 10:23  xavier

	* [r4969] src/states/states.F90: Bugfix: After Miguel's commit
	  [4921] the spinor tests started failing.
	  This fixes it, it seems to me that there was a previous bug for
	  systems with core corrections and spinors that Miguel's commit
	  extended to all systems with spinors.
	  
	  It would be nice it someone could review my changes.

2009-02-19 13:26  acastro

	* [r4970] src/states/states.F90: The previous commit (#4969)
	  "overcorrected" one mistake that caused a
	  failure in the spinors test since #4921. It turns out that one of
	  the
	  changes from spin_channels to nspin was right, but the other two
	  were
	  not. Now I think that the routine is correct, and the test is
	  passed.

2009-02-19 13:38  acastro

	* [r4971] src/main/casida.F90: Corrected a typo in the
	  documentation that caused some confusion in
	  the users. Thanks to Myrta Gruning for finding this out.

2009-02-19 14:29  xavier

	* [r4972] src/grid/submesh.F90, src/hamiltonian/projector.F90,
	  src/ions/solids.F90, src/main/main.F90, src/states/states.F90:
	  More fixes for MAX_DIM = 4.

2009-02-19 15:27  xavier

	* [r4973] src/ions/xyz_file.F90: Components higher than 3 of the
	  velocity are now initialized to zero.

2009-02-19 15:52  xavier

	* [r4974] configure.ac: Now the value of MAX_DIM can be changed
	  from the configure script.

2009-02-19 17:24  xavier

	* [r4975] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/ions/simul_box.F90, src/scf/scf.F90, src/states/states.F90:
	  Welcome to the fourth dimension!
	  ================================
	  
	  Now Octopus works in 4D mode, to do it you have to configure
	  octopus with
	  --with-max-dim=4 and put dimensions=4 in the input file. Only
	  non-iteracting electrons with user defined species can be used.

2009-02-19 17:48  xavier

	* [r4976] src/grid/hypercube.F90: Memory allocations made a huge
	  overhead in the hypercube routines.

2009-02-19 23:19  dstrubbe

	* [r4977] src/hamiltonian/epot.F90, src/hamiltonian/projector.F90,
	  src/td/td.F90: A recent change to projector_init_phases used a
	  variable which seems only to have been initialized in some cases
	  and not in others, causing a
	  segmentation fault. Now the dimension is explicitly passed in to
	  the function, like for projector_init and submesh_init_sphere.

2009-02-20 00:20  dstrubbe

	* [r4978] src/sternheimer/kdotp.F90: Stopped every node writing
	  about degenerate subspaces in calculation of effective masses.

2009-02-20 01:29  dstrubbe

	* [r4979] src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/system/pert_inc.F90: *)
	  Changed parenthesis for X() function macro to standard way we
	  write it
	  *) Took ownership of the two files for the kdotp perturbation

2009-02-20 02:01  dstrubbe

	* [r4980] src/hamiltonian/epot_inc.F90: *) Some fixes to the
	  calculation of forces and Born effective charges. I think
	  electron-ion forces in periodic systems were not being
	  calculated correctly since the boundary conditions were not set
	  on the ghost/boundary points before taking gradients.
	  *) Changed MAX_DIM to NDIM in a bunch of places to avoid seg
	  faults after the new 4D changes.
	  *) However, the Born charges (and hence probably the forces) are
	  still not right in periodic systems. More coming soon.

2009-02-20 03:26  dstrubbe

	* [r4981] src/math/math_inc.F90, src/system/pert_inc.F90: *) The
	  application of perturbations involved first applying phases
	  e^ikr. In fact, this is incorrect because when pseudopotential
	  projectors
	  are used, they apply these phases themselves. The phases are no
	  longer applied in the perturbations.
	  *) The phases were giving the correct result from derivatives,
	  i.e. e^-ikr grad (e^ikr u) = grad u + ik u. But it is simpler to
	  just write this
	  out where it occurs for the grad in kdotp and curl in magnetic.
	  *) To be able to use a cross product in a forall statement, I
	  declared the cross product a pure function.

2009-02-20 03:54  dstrubbe

	* [r4982] src/hamiltonian/epot_inc.F90: Now the boundary conditions
	  are set on NP_PART for the gradients as well, before they are
	  using applying pseudopotential projectors. Previously, the forces
	  in the cubic MgO crystal were exactly zero even when one of the
	  atoms was displaced. Now there is a reasonable force on that
	  displaced atom and its neighbors.
	  
	  However, the forces still break symmetry somewhat in the
	  undisplaced case, as they should actually be exactly zero then.
	  Perhaps this is due to problems in the ion-ion forces.

2009-02-20 11:14  acastro

	* [r4983] src/td/spectrum.F90: The minimization in spectrum_hs (to
	  get the maxima of the harmonic
	  spectrum) was not robust enough, which could cause the call to
	  GSL to
	  break. Now the code continues even if it does not find a minimum.

2009-02-20 16:00  xavier

	* [r4984] m4/sse.m4, src/beak/operate_ri_vec.c: This fixes the
	  compilation problem with icc 11.

2009-02-20 20:36  dstrubbe

	* [r4985] src/grid/cube_function_inc.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Added and fixed some
	  push_sub statements.

2009-02-20 22:18  dstrubbe

	* [r4986] src/grid/cube_function.F90,
	  src/grid/cube_function_inc.F90, src/grid/derivatives.F90,
	  src/poisson/poisson.F90, src/poisson/solver_3D.F90,
	  src/poisson/solver_fft.F90, src/system/v_ks.F90: *) Added and
	  fixed missing push_sub statements
	  *) Changed some MAX_DIM to 3 in cube functions; 3 is hard-coded
	  into
	  many places anyway, so it is certainly not general to more
	  dimensions
	  *) Some corrections to documentation
	  *) Translated MULTIGRILLA to MULTIGRID

2009-02-20 22:53  dstrubbe

	* [r4987] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/xc/vxc.F90: *) Added more push_sub statements
	  *) Changed m to mesh in derivatives
	  *) Replaced der%mesh%sb%dim by der%dim, since there was a more
	  direct
	  way to access this information, and since mesh%sb%dim seemed to
	  cause seg faults sometimes
	  
	  However, I have still not found the source of all the seg faults
	  on
	  corvo ...

2009-02-20 23:23  dstrubbe

	* [r4988] src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90: *) Trying to make pre-filter
	  preconditioner work for Sternheimer equation in periodic boundary
	  conditions. This does not seem to make any improvement though. It
	  still does not work.
	  *) Replaced PRE_SMOOTHING by PRE_FILTER for preconditioner to be
	  consistent with names in documentation

2009-02-20 23:32  dstrubbe

	* [r4989] src/system/pert_inc.F90: My previous commit removing the
	  application of k-point phases in perturbations was mistaken. Now
	  it is back as it was.

2009-02-21 00:00  dstrubbe

	* [r4990] src/grid/derivatives_inc.F90,
	  src/hamiltonian/epot_inc.F90: *) Now k-point phases are applied
	  in calculation of forces/Born charges too
	  *) A couple of debugging statements removed that was accidentally
	  left in a previous commit

2009-02-21 15:09  xavier

	* [r4991] src/sternheimer/em_resp.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90: Added the possibility of
	  giving arbitrary perturbed wave-functions to
	  the sternheimer equation.

2009-02-22 08:40  xavier

	* [r4992] src/hamiltonian/epot_inc.F90: An error in the application
	  in the phases when calculating the forces
	  was causing out of bound accesses.

2009-02-22 20:35  dstrubbe

	* [r4993] src/grid/derivatives_inc.F90, src/hamiltonian/epot.F90,
	  src/poisson/Makefile.am, src/poisson/conj_grad.F90,
	  src/poisson/corrections.F90, src/poisson/cutoffs.F90,
	  src/poisson/poisson_cg.F90, src/poisson/poisson_corrections.F90,
	  src/poisson/poisson_cutoff.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_fft.F90, src/poisson/solver_isf.F90,
	  src/poisson/solver_multigrid.F90: *) Corrected comments about
	  setting boundary conditions for derivatives
	  *) Changed names of files in poisson directory to correspond with
	  the names of the modules
	  *) Also changed a couple of push_sub statements and module names
	  to make everything consistent

2009-02-22 22:17  dstrubbe

	* [r4994] src/ions/simul_box.F90: The routine to periodically
	  translate atoms into the simulation box was not taking into
	  account the BoxOffset. Now it does.

2009-02-24 15:43  xavier

	* [r4995] src/basic/loct_parser.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/ob_lead.F90, src/hamiltonian/species_pot.F90,
	  src/ions/simul_box.F90, src/opt_control/initst.F90,
	  src/opt_control/target.F90, src/poisson/poisson_fft.F90,
	  src/species/species.F90, src/states/restart.F90: Now
	  loct_parse_expression takes a vector instead of the individual
	  components.

2009-02-24 16:01  xavier

	* [r4996] liboct_parser/parser_f.c, src/basic/loct_parser.F90: Now
	  the C routine for parsing expression also takes a vector.

2009-02-24 16:25  xavier

	* [r4997] liboct_parser/parser_f.c: Now a 4d potential can be
	  specified by using 'w' as the fourth
	  dimension.

2009-02-25 10:25  marques

	* [r4998] libxc/src/Makefile.am, libxc/src/lda_c_1d_csc.c,
	  libxc/src/libxc_master.F90, libxc/src/test.c,
	  libxc/src/work_lda_1d.c, libxc/src/xc.h, libxc/src/xc_config.h,
	  libxc/src/xc_f.c, src/xc/functionals.F90: I implemented the 1D
	  correlation LDA of Barone's group. Note that this
	  has not been tested, and that there is the exchange missing...

2009-02-25 11:46  xavier

	* [r4999] src/grid/mesh_init.F90: A stencil is now always used to
	  partition the mesh.

2009-02-25 17:14  xavier

	* [r5000] src/grid/mesh_init.F90: Generalized some parts of the
	  initialization of the mesh in parallel to an
	  arbitrary number of dimensions.

2009-02-25 17:40  xavier

	* [r5001] libxc/src/Makefile.am, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_2d_prm08.c, libxc/src/libxc_master.F90,
	  libxc/src/xc.h, libxc/src/xc_f.c,
	  libxc/testsuite/xc-consistency.c, src/xc/functionals.F90: Due to
	  the 31 character limitation I had to rename the lda_c_2d_prm08
	  functional
	  to lda_c_2d_prm. Miguel, can you check that I did it correctly?

2009-02-25 22:18  xavier

	* [r5002] src/grid/Makefile.am, src/grid/mesh_init.F90: Domain
	  parallelization now works in 4D.

2009-02-26 02:12  dstrubbe

	* [r5003] src/basic/loct_parser.F90: The Portland compiler objected
	  to the way the interface was declared in loct_parser, giving the
	  error:
	  PGF90-S-0070-Incorrect sequence of statements (loct_parser.F90:
	  233)
	  I moved the "module procedure" lines to after the subroutine,
	  which is what the Intel Fortran reference says is how the syntax
	  is supposed to go. I hope this is what was meant.

2009-02-26 09:25  xavier

	* [r5004] src/grid/grid.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/states/restart.F90: Some code
	  cleaning.

2009-02-26 16:42  xavier

	* [r5005] src/grid/double_grid_apply.F90, src/math/fftw3.F90: Some
	  fixes for max-dim=4.

2009-02-26 21:18  dstrubbe

	* [r5006] src/grid/mesh_function_inc.F90, src/ions/simul_box.F90,
	  src/states/states.F90, src/sternheimer/kdotp.F90: *) Turned on
	  calculation of effective masses by default, since it doesn't take
	  much time and is useful as a diagnostic
	  *) Replaced some MAX_DIM by mesh%sb%dim, which were causing a seg
	  fault
	  *) Changed "m" to "mesh" in various places
	  *) Changed another one-character name: "c" to "cube"
	  *) Added a warning to documentation on variable BoxOffset since
	  its use seems to change the results for the ground state
	  significantly.
	  *) Changed "st%wfs_type == M_REAL" to "states_are_real(st)" in
	  one place

2009-02-27 02:59  dstrubbe

	* [r5007] src/sternheimer/kdotp.F90: Now the actual default value,
	  not just the documentation, for CalculateEffectiveMasses has been
	  changed.

2009-02-28 12:13  acastro

	* [r5008] src/hamiltonian/lasers.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/one_shot.F90,
	  src/main/phonons_fd.F90, src/main/unocc.F90,
	  src/opt_control/initst.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/scf/scf.F90,
	  src/states/states.F90, src/system/system.F90, src/td/td.F90,
	  src/td/td_init.F90, src/td/td_rti.F90: o The states_calc_dim
	  subroutine accepted a states_t argument as
	  intent(in), and a density as intent(out). However, in most cases
	  it
	  was the density inside the states_t variable that was passed as
	  the
	  density to be computed. This is inconsistent, although probable
	  legal
	  since the compilers did not complain. In anycase, I think it is
	  better
	  and easier to use an optional argument, that does not need to be
	  passed if it is the density of the states_t argument the one that
	  we
	  want to calculate.
	  
	  o Simplified the optimal control code in several points. Also,
	  added
	  some comments and documentation.

2009-03-01 13:59  rozzi

	* [r5009] src/grid/mesh.F90, src/hamiltonian/hamiltonian.F90:
	  implemented absorbing boundaries for the minimum box

2009-03-01 19:53  xavier

	* [r5010] src/grid/Makefile.am, src/grid/cubic_mesh.F90,
	  src/grid/cubic_mesh_low.c: This is the initial implementation of
	  the cubic grid in C. The idea is
	  to be able to use any C FFT library and avoid all the transposing
	  done
	  by Fortran FFTW.

2009-03-02 01:27  dstrubbe

	* [r5011] src/grid/io_function_inc.F90: Renamed "m" and "c" to
	  "mesh" and "cube" in some places.

2009-03-02 02:03  xavier

	* [r5012] src/hamiltonian/gauge_field.F90: The plasmon frequency
	  now is printed the correct units.

2009-03-02 10:42  xavier

	* [r5013] m4/sse.m4: Made the SSE2 test more strict by including an
	  operation in the test
	  code. Miguel can you check whether it solves the problem with
	  pathscale?

2009-03-02 13:42  marques

	* [r5014] configure.ac, m4/sse.m4: Xavier's hack did not work, so I
	  decided to revert it and to include a
	  switch to explicitly disable sse2. In this way the user can work
	  around
	  buggy compilers (even the latest version of pathscale 3.2 has the
	  problem)

2009-03-03 00:41  dstrubbe

	* [r5015] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/ions/simul_box.F90, src/states/restart.F90,
	  src/system/output_h_sys.F90: *) Corrected push_sub's
	  *) Removed references to obsolete gnuplot option to OutputHow,
	  which had no effect anyway
	  *) Added XCrySDen format for 3D data
	  *) Added documentation about printing linear-response density,
	  which was not mentioned in the variable reference although it was
	  implemented

2009-03-03 05:09  dstrubbe

	* [r5016] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/main/casida_inc.F90, src/main/static_pol.F90,
	  src/sternheimer/em_resp.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/system.F90: *) Now
	  XCrySDen output includes the actual atomic coordinates. Passing
	  in the geometry to the output functions required changes in many
	  places. Coordinates are offset so that an atom at (0,0,0) would
	  be in the center of the cell.
	  *) A small change to the XCrysDen output grid due to this strange
	  thing about general vs periodic grids.
	  *)

2009-03-03 07:50  acastro

	* [r5017] src/main/unocc.F90, src/opt_control/finalcheck.F90,
	  src/opt_control/opt_control.F90, src/opt_control/target.F90:
	  h_sys_output_states has a new interface, but its calls were not
	  updated all over the code. Now I think the all are.

2009-03-03 08:17  acastro

	* [r5018] src/poisson/poisson_fft.F90,
	  src/poisson/poisson_finite_cyl.c: A couple of bugs resulted in
	  massive memory usage when running in 2D
	  with different spacings. Thanks to Matthieu for reporting this
	  bug.

2009-03-03 10:14  xavier

	* [r5019] src/grid/cubic_mesh.F90, src/grid/cubic_mesh_low.c: Small
	  fixes in the cubic mesh.

2009-03-03 13:24  marques

	* [r5020] src/sternheimer/em_resp_calc_inc.F90,
	  src/system/pert.F90: Corrected reference and removed duplicated
	  print

2009-03-03 15:57  acastro

	* [r5021] src/math/sparskit.F90, src/td/td_rti.F90: The code did
	  not compile with sparskit, due to a couple of
	  details. Now it does (did not check that it still works with
	  sparskit,
	  though).

2009-03-03 17:47  nitsche

	* [r5022] src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/states/restart.F90, src/states/states.F90: * changed the way
	  to check the mesh-block-size if open boundaries scheme is used,
	  now the size must explicitly set to 1
	  * read_free_states now only reads the occupied states (this
	  should change when xc is implemented for transport)
	  * vec_global2local did not check if the array global was actually
	  associated
	  * bugfix (NP -> NP_PART)
	  * new optional parameter for states_look to look for occupied
	  states

2009-03-04 01:10  xavier

	* [r5023] src/grid/cubic_mesh.F90, src/grid/cubic_mesh_low.c: Added
	  some functions to the cubic_mesh.

2009-03-04 06:26  xavier

	* [r5024] src/utils/dielectric_function.F90: Some fixes in the
	  calculation of the dielectric function.

2009-03-04 06:31  xavier

	* [r5025] external_libs/spglib/AUTHORS,
	  external_libs/spglib/COPYING, external_libs/spglib/ChangeLog,
	  external_libs/spglib/INSTALL, external_libs/spglib/Makefile.am,
	  external_libs/spglib/Makefile.in, external_libs/spglib/NEWS,
	  external_libs/spglib/README, external_libs/spglib/aclocal.m4,
	  external_libs/spglib/bravais.c, external_libs/spglib/bravais.h,
	  external_libs/spglib/cell.c, external_libs/spglib/cell.h,
	  external_libs/spglib/compile, external_libs/spglib/config.guess,
	  external_libs/spglib/config.h.in,
	  external_libs/spglib/config.sub, external_libs/spglib/configure,
	  external_libs/spglib/configure.ac, external_libs/spglib/depcomp,
	  external_libs/spglib/install-sh, external_libs/spglib/ispglib.h,
	  external_libs/spglib/ltmain.sh, external_libs/spglib/mathfunc.c,
	  external_libs/spglib/mathfunc.h, external_libs/spglib/missing,
	  external_libs/spglib/pointgroup.c,
	  external_libs/spglib/pointgroup.h,
	  external_libs/spglib/primitive.c,
	  external_libs/spglib/primitive.h, external_libs/spglib/python,
	  external_libs/spglib/python/Makefile.am,
	  external_libs/spglib/python/Makefile.in,
	  external_libs/spglib/python/ase,
	  external_libs/spglib/python/ase/Makefile,
	  external_libs/spglib/python/ase/_spglib.c,
	  external_libs/spglib/python/ase/conf.py,
	  external_libs/spglib/python/ase/example_ase.py,
	  external_libs/spglib/python/ase/index.rst,
	  external_libs/spglib/python/ase/setup.py,
	  external_libs/spglib/python/ase/spglib.py,
	  external_libs/spglib/python/ase/src,
	  external_libs/spglib/python/example.py,
	  external_libs/spglib/python/libpyspg.c,
	  external_libs/spglib/ruby, external_libs/spglib/ruby/example1.c,
	  external_libs/spglib/ruby/example1.rb,
	  external_libs/spglib/ruby/extconf_example1.rb,
	  external_libs/spglib/spacegroup.c,
	  external_libs/spglib/spacegroup.h,
	  external_libs/spglib/spacegroup_data.c,
	  external_libs/spglib/spacegroup_data.h,
	  external_libs/spglib/spacegroup_database.c,
	  external_libs/spglib/spacegroup_database.h,
	  external_libs/spglib/spglib.c, external_libs/spglib/spglib.h,
	  external_libs/spglib/spglib_f.c, external_libs/spglib/src,
	  external_libs/spglib/src/ChangeLog,
	  external_libs/spglib/src/Makefile.am,
	  external_libs/spglib/src/Makefile.in,
	  external_libs/spglib/src/bravais.c,
	  external_libs/spglib/src/bravais.h,
	  external_libs/spglib/src/bravais_art.c,
	  external_libs/spglib/src/bravais_art.h,
	  external_libs/spglib/src/cell.c, external_libs/spglib/src/cell.h,
	  external_libs/spglib/src/debug.c,
	  external_libs/spglib/src/debug.h,
	  external_libs/spglib/src/mathfunc.c,
	  external_libs/spglib/src/mathfunc.h,
	  external_libs/spglib/src/pointgroup.c,
	  external_libs/spglib/src/pointgroup.h,
	  external_libs/spglib/src/primitive.c,
	  external_libs/spglib/src/primitive.h,
	  external_libs/spglib/src/spacegroup.c,
	  external_libs/spglib/src/spacegroup.h,
	  external_libs/spglib/src/spacegroup_data.c,
	  external_libs/spglib/src/spacegroup_data.h,
	  external_libs/spglib/src/spacegroup_database.c,
	  external_libs/spglib/src/spacegroup_database.h,
	  external_libs/spglib/src/spglib.c,
	  external_libs/spglib/src/spglib.h,
	  external_libs/spglib/src/symmetry.c,
	  external_libs/spglib/src/symmetry.h,
	  external_libs/spglib/symmetry.c, external_libs/spglib/symmetry.h,
	  external_libs/spglib/test.c: Updated spglib to version 0.5.1.

2009-03-04 07:28  xavier

	* [r5026] external_libs/spglib/Makefile.am,
	  external_libs/spglib/Makefile.in,
	  external_libs/spglib/aclocal.m4, external_libs/spglib/compile,
	  external_libs/spglib/config.guess,
	  external_libs/spglib/config.h.in,
	  external_libs/spglib/config.sub, external_libs/spglib/configure,
	  external_libs/spglib/configure.ac, external_libs/spglib/depcomp,
	  external_libs/spglib/install-sh, external_libs/spglib/ltmain.sh,
	  external_libs/spglib/missing, external_libs/spglib/python,
	  external_libs/spglib/ruby, external_libs/spglib/src/Makefile.am,
	  external_libs/spglib/src/Makefile.in: * The new version of spglib
	  is now compiled.
	  * Removed some useless parts of spglib.

2009-03-04 10:47  mjv500

	* [r5027] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/output_h_sys.F90:
	  added mass_scaling input var

2009-03-04 12:05  xavier

	* [r5028] configure.ac, external_libs/spglib/src/Makefile.am,
	  src/common-rules.make, src/ions/Makefile.am, src/ions/spglib_f.c,
	  src/ions/symmetries.F90: Initial implementation of an interface
	  for spglib.

2009-03-04 13:27  acastro

	* [r5029] src/ions/symmetries.F90: My compiler complained about the
	  procedures "symmetries_init" and
	  "symmetries_end" being public, and the data type "symmetries_t"
	  not
	  being public. If it is not public, it cannot be the argument of a
	  public procedure.
	  
	  The components of symmetries_t may be private, though.

2009-03-04 21:35  rozzi

	* [r5030] share/util/mf.cfg, share/util/mf.net: Added a new "TD"
	  module to the dx script. This mode allows to generate a set of
	  images from a td run. The user must choose some parameters like
	  the number of time steps between consecutive frames, the value
	  and units of the time step, etc., and then the sequencer can be
	  used to go through the files in the proper td.* directories to
	  generate the images. You can conveniently combine this module
	  with the "Script mode". Press play, go for a coffee (or a beer),
	  and when you are back all the images are ready to be joined into
	  a movie. Since only one sequencer is allowed to exist, I had to
	  remove it from the slab module, where i feel it is less
	  necessary.

2009-03-04 23:51  dstrubbe

	* [r5031] src/grid/mesh_function_inc.F90: *) Some fixes to
	  push_sub's
	  *) Removed one-line setting of defaults for optional arguments
	  which can cause a seg-fault.

2009-03-05 04:59  xavier

	* [r5032] src/ions/Makefile.am, src/ions/crystal.F90,
	  src/ions/spglib_f.c, src/ions/symmetries.F90,
	  src/states/states_kpoints.F90: * Now spglib is used to analyze
	  the symmetries of the system. This is
	  much cleaner than the previous code we had.
	  
	  * Generation of k-point is now always done following the
	  Monkhorstpack
	  scheme..

2009-03-05 07:40  xavier

	* [r5033]
	  testsuite/periodic_systems/01-free_electrons.01-ground_state.inp,
	  testsuite/periodic_systems/02-cosine_potential.01-ground_state.inp,
	  testsuite/periodic_systems/03-sodium_chain.01-ground_state.inp,
	  testsuite/periodic_systems/03-sodium_chain.02-ground_state_disp.inp,
	  testsuite/periodic_systems/04-silicon.01-gs.inp: The tests for
	  periodic systems now have the k points explicitly in the
	  input file (until the new k point generator completely
	  functional).

2009-03-05 07:47  xavier

	* [r5034] src/ions/crystal.F90: For the moment symmetry reduction
	  of the Brillouin zone only works for
	  periodicity in 3 dimensions.

2009-03-05 09:13  marques

	* [r5035] libxc/src/lda_c_hl.c, libxc/src/lda_c_pw.c,
	  libxc/src/lda_c_pz.c, libxc/src/lda_c_rpa.c,
	  libxc/src/lda_c_vwn.c, libxc/src/lda_c_wigner.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/work_lda.c: Cleaned a bit
	  the LDAs.

2009-03-05 13:04  marques

	* [r5036] libxc/src/lda.c, libxc/src/lda_c_hl.c,
	  libxc/src/lda_c_pw.c, libxc/src/lda_c_pz.c,
	  libxc/src/lda_c_rpa.c, libxc/src/lda_c_vwn.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_c_xalpha.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/test.c, libxc/src/util.h,
	  libxc/src/work_lda.c, libxc/src/xc.h: *) Simplified a bit more
	  the interface to the routines.
	  *) Added support for spin-unpolarized Kxc, and added the third
	  derivatives of wigner and rpa corelation functionals.

2009-03-05 16:24  mjv500

	* [r5037] src/ions/crystal.F90: presumed 3D kpoints

2009-03-05 16:25  mjv500

	* [r5038] src/states/states_calc.F90: presumed 3D kpoints

2009-03-05 16:27  mjv500

	* [r5039] src/grid/mesh_function_inc.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90, src/states/embedded_particles.F90,
	  src/states/states.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: embedded particles and density
	  matrix modules

2009-03-05 19:30  xavier

	* [r5040] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian.F90: * Fixed a memory leak in the
	  calculation of the forces.
	  * Some output in hamiltonian_init is outdated.
	  * Removed the debubgging output of the mass scaling.

2009-03-05 20:44  dstrubbe

	* [r5041] src/ions/crystal.F90: A push_sub got lost in the
	  reorganization of the code.

2009-03-05 22:49  xavier

	* [r5042] src/ions/symmetries.F90: Included the option of
	  generating a k point grid with reduced symmetry.

2009-03-06 00:35  dstrubbe

	* [r5043] src/system/energy_inc.F90: Fixed up some more push_sub's.
	  Really a large fraction of them do not actually correspond to the
	  file name and function name.

2009-03-06 00:37  dstrubbe

	* [r5044] src/scf/lcao_inc.F90: More push_sub's.

2009-03-06 00:39  dstrubbe

	* [r5045] src/scf/eigen_cg_inc.F90: push_sub's

2009-03-06 00:40  dstrubbe

	* [r5046] src/states/states_calc_inc.F90: push_sub's

2009-03-06 00:41  dstrubbe

	* [r5047] src/grid/batch.F90: push_sub's

2009-03-06 00:42  dstrubbe

	* [r5048] src/grid/batch_inc.F90: More push_sub's corrected while
	  using DebugLevel = 2 for stack trace

2009-03-06 00:44  dstrubbe

	* [r5049] src/grid/mesh_init.F90: push_sub's

2009-03-06 00:46  dstrubbe

	* [r5050] src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90:
	  push_sub's and comments

2009-03-06 01:37  dstrubbe

	* [r5051] src/grid/par_vec.F90, src/grid/par_vec_inc.F90:
	  push_sub's and comments

2009-03-06 03:09  dstrubbe

	* [r5052] src/ions/simul_box.F90: push_sub's

2009-03-06 03:48  xavier

	* [r5053] src/ions/symmetries.F90: I disabled for the moment the
	  output of the symmetry information.

2009-03-06 10:08  marques

	* [r5054] external_libs/spglib/src/Makefile.am: debug.h has to be
	  referenced in the Makefile, otherwise it will not be
	  added to the distribution

2009-03-06 16:10  mjv500

	* [r5055] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/density_matrix.F90:
	  generalized densmat calculation to any dimension and choice of
	  embedded particle

2009-03-06 22:11  dstrubbe

	* [r5056] src/grid/derivatives_inc.F90, src/scf/subspace_inc.F90:
	  push_sub's

2009-03-07 01:39  dstrubbe

	* [r5057] src/grid/double_grid.F90, src/grid/double_grid_apply.F90,
	  src/hamiltonian/projector.F90, src/species/species.F90:
	  push_sub's and comments

2009-03-07 15:33  acastro

	* [r5058] src/poisson/Makefile.am, src/poisson/poisson.F90,
	  src/poisson/poisson_cutoff.F90, src/poisson/poisson_cutoffs.c,
	  src/poisson/poisson_fft.F90, src/poisson/poisson_finite_cyl.c,
	  src/poisson/solver_1D.F90, src/poisson/solver_3D.F90: Added the
	  reciprocal space method to integrate Hartree's integral in
	  1D for finite systems. That is, implemented the cutoff soft
	  Coulomb
	  interaction in reciprocal space for finite ("0D-periodic")
	  systems in
	  1D. This method is now the default, instead the direct sum
	  ("direct1D"), since it is way faster.
	  
	  Also, corrected the case of 1D-periodic systems in 1D, which was
	  wrong
	  because of a wrong factor in the definition of the soft-Coulomb
	  interaction in reciprocal space.
	  
	  This means that we now have reciprocal space Hartree integral
	  integrators for all possible dimensions, and periodicities:
	  3D/3D,
	  3D/2D, 3D/1D, 3D/0D, 2D/2D, 2D/1D, 2D/0D, 1D/1D and finally,
	  1D/0D (in
	  the 1D case, we assume soft Coulomb instead of normal Coulomb
	  since
	  otherwise we get infinities everywhere).

2009-03-07 18:10  acastro

	* [r5059] src/grid/mesh_init.F90: Variable "p", which should
	  contain the number of real space
	  partitions, was being used uninitialized in routine
	  mesh_partition. This caused octopus to break with my compiler,
	  although I guess some other compilers/setups would just put a
	  zero for
	  p. This however, meant that the if clause
	  
	  if(p .lt. 8) then
	  default_method = RCB
	  else
	  default_method = GRAPH
	  end if
	  
	  
	  would always be true for "RCB", whatever it means. I think it has
	  been
	  this way since r4657. Xavier, maybe you want to check this, in
	  case it
	  is relevant.

2009-03-08 08:19  dstrubbe

	* [r5060] src/grid/double_grid.F90, src/hamiltonian/projector.F90,
	  src/species/species.F90, src/sternheimer/em_resp_calc.F90: Some
	  trivial changes.

2009-03-08 11:01  xavier

	* [r5061] src/ions/simul_box.F90, src/states/states_kpoints.F90: *
	  Bugfix: the default k point was not initialized properly.
	  
	  * Removed debugging output for simul_box_in_box.

2009-03-08 11:35  xavier

	* [r5062] src/opt_control/parameters.F90: Added (again) a
	  workaround for a bug in the IBM compiler. This time I
	  put a comment to avoid it being reverted.

2009-03-09 09:11  marques

	* [r5063] libxc/src/lda.c, libxc/src/lda_c_rpa.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_xc_teter93.c,
	  libxc/src/test.c, libxc/src/util.h, libxc/src/work_lda.c,
	  src/xc/fxc.F90, src/xc/kxc.F90, src/xc/vxc.F90: *) Added support
	  for the calculation of kxc (the 3rd derivative of Exc)
	  in libxc. I also changed the interface to something more
	  reasonable. Now
	  we have, when spin is polarized, kxc(4) = (uuu, uud, udd, ddd)
	  
	  *) Now octopus does stop if one tries to run with fxc or kxc !=
	  LDA. Up
	  to now it was simply ignoring fxc (i.e., it was performing an RPA
	  calculation). David and Xavier, please check this one out.

2009-03-09 10:16  marques

	* [r5064] libxc/src/lda_c_pz.c,
	  testsuite/linear_response/02-h2o_pol_lr.test: Now Perdew-Zunger
	  has analitic 3rd derivatives. Due to that, the values
	  of the hyperpolarizability test changed slightly (4th digit)

2009-03-09 12:30  marques

	* [r5065] Makefile.am, liboct_parser/parser_f.c,
	  liboct_parser/string_f.h, libstring_f, libxc/DONE,
	  libxc/src/test.c, src/basic/getopt_f.c, src/basic/io_binary.c,
	  src/basic/oct_f.c, src/basic/oct_gdlib_f.c, src/basic/recipes.c,
	  src/basic/varinfo_low.c, src/basic/write_iter_low.c,
	  src/common-rules.make: I got rid of libstring_f. It was replaced
	  simply by a header file
	  (string_f.h) that is included twice in octopus (liboct_parser and
	  libxc/src). The main difference is that TO_C_STR passed to a
	  subroutien
	  instead of a function.
	  
	  I used the opportunity to fix the strcasestr definition that was
	  quite
	  broken.

2009-03-09 13:39  mjv500

	* [r5066] src/states/density_matrix.F90: generalize output file
	  names dens mat

2009-03-09 14:08  marques

	* [r5067] libxc/DONE, libxc/src/lda_c_pw.c: Now pw also has
	  analytical Kxc

2009-03-09 16:51  mjv500

	* [r5068] src/states/density_matrix.F90: added normal density
	  output (in embedded dimensions)

2009-03-09 16:52  mjv500

	* [r5069] configure.ac, liboct_parser/Makefile.am,
	  libxc/configure.ac, src/common-rules.make: had to fix
	  dependencies after removal of libstring_f - someone competent
	  check this

2009-03-09 20:47  helbig

	* [r5070] src/states/density_matrix.F90: potential calculation
	  commented out

2009-03-10 01:21  xavier

	* [r5071] testsuite/periodic_systems/05-lithium.01-gs.inp,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/periodic_systems/Makefile.am: Added test for the time
	  propagation with gauge field in solids.

2009-03-10 01:29  acastro

	* [r5072] src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90:
	  Bug fixed: some uninitialized variables (only when running in
	  parallel).

2009-03-10 04:30  xavier

	* [r5073] src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian_inc.F90: Moved the application of the
	  gauge field to its own module.

2009-03-10 06:04  xavier

	* [r5074] src/td/td.F90,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.03-td-restart.inp,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/periodic_systems/Makefile.am: * Restart functionality
	  for simulations with gauge field was not working.
	  * The restart of the simulation is now checked by the test.

2009-03-10 09:04  xavier

	* [r5075] src/hamiltonian/gauge_field.F90, src/td/td.F90,
	  src/td/td_rti.F90: Now gauge_field_get_force returns an object of
	  type gauge_force_t.

2009-03-10 10:53  mjv500

	* [r5076] src/states/Makefile.am, src/states/density_matrix.F90,
	  src/states/embedded_particles.F90,
	  src/states/modelmb_particles.F90, src/system/output_states.F90:
	  changed naming of embedded to modelmb

2009-03-11 08:58  marques

	* [r5077] libxc/src/Makefile.am, libxc/src/lda_c_vwn.c,
	  libxc/src/xc_f.c: Now also VWN has analytical Kxc

2009-03-11 09:00  marques

	* [r5078] libxc/src/string_f.h: It is easier to maintain a copy of
	  this file here, so that this library
	  is indeed independent.

2009-03-12 00:06  helbig

	* [r5079] src/grid/mesh_function_inc.F90,
	  src/states/density_matrix.F90, src/states/ksinversion.F90,
	  src/states/modelmb_particles.F90: density matrix normalized,
	  kspotential inversion added(not working yet)

2009-03-12 00:37  mjv500

	* [r5080] src/states/Makefile.am, src/states/ksinversion.F90:
	  cleaned ksinversion

2009-03-14 14:58  helbig

	* [r5081] src/grid/mesh_function_inc.F90,
	  src/states/density_matrix.F90, src/states/ksinversion.F90:
	  calculation of density for ModelMB, cleaned density matrix,
	  continued with KS potential calculation

2009-03-14 15:47  mjv500

	* [r5082] src/states/density_matrix.F90: modif output names for
	  density matrices

2009-03-15 12:00  xavier

	* [r5083] src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/scf/ground_state.F90,
	  src/scf/scf.F90, src/td/td_init.F90: Changed the order of the
	  arguments of scf_init.

2009-03-15 23:12  xavier

	* [r5084] src/main/run.F90, src/opt_control/opt_control.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/td/td.F90, src/td/td_init.F90: Some consistency fixes:
	  
	  * Renamed timedep_m to td_m.
	  * Changed the order of the parameters for td_init.

2009-03-16 08:33  marques

	* [r5085] libxc/src/gga_x_am05.c, libxc/src/gga_x_b86.c,
	  libxc/src/gga_x_b86_mgc.c, libxc/src/gga_x_b88.c,
	  libxc/src/gga_x_bayesian.c, libxc/src/gga_x_dk87.c,
	  libxc/src/gga_x_ft97.c, libxc/src/gga_x_g96.c,
	  libxc/src/gga_x_lg93.c, libxc/src/gga_x_mpbe.c,
	  libxc/src/gga_x_optx.c, libxc/src/gga_x_pbe.c,
	  libxc/src/gga_x_pbea.c, libxc/src/gga_x_pw86.c,
	  libxc/src/gga_x_pw91.c, libxc/src/gga_x_rpbe.c,
	  libxc/src/gga_x_wc.c, libxc/src/lda_x.c, libxc/src/mgga_x_m06l.c,
	  libxc/src/test.c, libxc/src/util.h, libxc/src/work_gga_x.c: Som
	  cleaning in the ggas

2009-03-17 10:03  mjv500

	* [r5086] libxc/src/lda_x.c: MIGUEL CHECK THIS stray float

2009-03-17 16:28  mjv500

	* [r5087] src/states/density_matrix.F90,
	  src/states/modelmb_particles.F90: added dipole moment calculation

2009-03-19 05:35  xavier

	* [r5088] src/grid/derivatives_inc.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/epot_inc.F90, src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/geom_opt.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/poisson/poisson.F90,
	  src/scf/scf.F90, src/states/elf.F90, src/states/magnetic.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/states/states_calc_inc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/vdW.F90,
	  src/system/exponential_split.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/system.F90, src/system/v_ks.F90, src/td/td.F90,
	  src/td/td_calc.F90, src/td/td_write.F90, src/xc/axc.F90,
	  src/xc/vxc.F90: Removed the NDIM macro.

2009-03-19 05:54  xavier

	* [r5089] src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/gcm.F90, src/main/unocc_inc.F90,
	  src/opt_control/initst.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao_inc.F90, src/scf/ob_lippmann_schwinger.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/magnetic.F90, src/states/states.F90,
	  src/states/states_block.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners_inc.F90, src/td/td_rti.F90,
	  src/xc/axc.F90, src/xc/vxc.F90: Removed the NP_PART macro.

2009-03-20 09:48  marques

	* [r5090] configure.ac, liboct_parser/Makefile.am,
	  libxc/configure.ac, libxc/src/Makefile.am,
	  libxc/src/lda_c_1d_csc.c, libxc/src/lda_c_2d_amgb.c,
	  libxc/src/lda_x.c, libxc/src/test.c, libxc/src/work_lda.c,
	  libxc/src/work_lda_1d.c, src/common-rules.make,
	  src/xc/functionals.F90, src/xc/xc.F90,
	  testsuite/finite_systems_2d/01-quadratic_box.03-hartree+xc.inp,
	  testsuite/finite_systems_2d/01-quadratic_box.04-spin_polarized.inp:
	  Reorganization of the LDAs of reduced dimension. Now there is a
	  common
	  driver routine in work_lda that handles 1, 2, and 3 dimensions. I
	  also
	  took the opportunity to add fxc and kxc to the 2d ldas (both
	  exchange
	  and amgb). I do not know if his is useful (someone interested in
	  hyperpolarizabilities of 2D systems?), but I added it for
	  completeness.

2009-03-20 12:00  marques

	* [r5091] libxc/DONE, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_hl.c, libxc/src/test.c: Some more fixes, and now
	  HL also has Kxc.

2009-03-20 14:40  marques

	* [r5092] libxc/src/lda_x_2d.c: Forgot this file... sorry.

2009-03-20 15:31  marques

	* [r5093] src/grid/derivatives.F90: After many requests by Matthieu
	  and Nicole, I included the possibility
	  of having different masses in the different spatial directions.
	  This is
	  controlled by the block MoldelMBMasses. I am not 100% sure that
	  this
	  works, but I think so (the harmonic oscillator works ;). The idea
	  is to
	  do a coordinate transformation when one calculates the
	  coefficients of
	  the derivatives. Note that this is a hack, and that *all*
	  derivatives in
	  the code will be afected, so be careful.
	  
	  Note that I created a new section for the variables related to
	  the
	  Many-body models (Hamiltonian::Models). Matthieu and Nicole,
	  could you
	  please move the variables you have introduced there?

2009-03-20 15:41  marques

	* [r5094] src/grid/derivatives.F90: Sorry, I had forgotten to
	  change the name of the variable ;)

2009-03-21 18:28  acastro

	* [r5095] src/grid/derivatives.F90: Changed the name of
	  "MoldelMBMasses" to "ModelMBMasses", which I
	  assume was the first idea; and added the "%End% at the end of the
	  documentation block (otherwise the perl scripts complains).

2009-03-22 14:21  acastro

	* [r5096] src/hamiltonian/lasers.F90,
	  src/opt_control/check_input.F90, src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp: Corrected
	  outdated documentation, added some more, added comments to
	  make the code more readable. Also, reorganised a couple of things
	  in
	  order to make things more intuitive for the user/developer (all
	  this
	  refers exclusively to OCT stuff).

2009-03-23 07:38  marques

	* [r5097] src/grid/derivatives.F90: Forgot the block_end call. I am
	  really rusty ;))

2009-03-24 15:04  nitsche

	* [r5098] src/grid/io_function_inc.F90: * updated
	  X(output_function) to handle also non-domain parallelization
	  
	  Comment: "ParallelizationStrategy = par_kpoints" is NOT working
	  (e.g. try 01-free_electrons.01-ground_state.inp), with the
	  following commits I am trying to fix some of these issues. I
	  would be glad if someone could check my changings as I am not an
	  expert in MPI...

2009-03-24 15:26  nitsche

	* [r5099] src/grid/mesh_init.F90, src/states/restart.F90: *
	  mesh_init.F90: uninitialized pointers for parallelization,
	  splitted an if statement due to an uninitialized array
	  * restart.F90: uninitialized pointer, splitted if statement if
	  read error occurs, fixed problem in read_free_states with
	  parallelization in kpoints

2009-03-24 15:58  nitsche

	* [r5100] src/system/output_states.F90: * fixed some outputs
	  related to non-domain parallelization

2009-03-24 16:56  nitsche

	* [r5101] src/td/ob_rti.F90, src/td/td_write.F90: * fixed bugs
	  related to kpoints-parallelization

2009-03-24 20:41  acastro

	* [r5102] src/hamiltonian/epot.F90: Bug fix: when using
	  pseudopotential with core charge corrections, this
	  core-charge was "accumulated" every time the ionic potential was
	  computed. This was not a problem for single-point calculations,
	  since
	  this potential was computed only once. However, it was a problem
	  for
	  example for geometry-optimization runs (in fact, I found the bug
	  because it was reported as a problem with geometry optimization
	  in the
	  mailing list).
	  
	  Version 3.0.1 is also affected by this bug (I will correct it
	  also in
	  3.0.x branch, since it is somehow a "severe" bug), and I guess
	  that
	  also td runs were compromised, if the ions moved.

2009-03-24 20:50  acastro

	* [r5103] src/hamiltonian/epot.F90: Sorry, my previous bug-fix was
	  buggy.

2009-03-25 10:00  nitsche

	* [r5105] src/hamiltonian/epot.F90, src/td/td.F90: * fixes related
	  to kpoint-parallelization

2009-03-25 10:07  nitsche

	* [r5106] src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90: * fixes related to
	  kpoint-parallelization

2009-03-25 10:35  nitsche

	* [r5107] src/hamiltonian/hamiltonian.F90, src/states/states.F90: *
	  again fixes issues due to kpoints-parallelization

2009-03-25 11:00  nitsche

	* [r5108] src/hamiltonian/gauge_field.F90,
	  src/states/excited_states_inc.F90: * removed useless loop
	  * fixes due to kpoints parallelization

2009-03-25 11:16  nitsche

	* [r5109] src/states/states_calc.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/pert_inc.F90: *
	  fixed issues related to kpoint parallelization

2009-03-25 11:22  nitsche

	* [r5110] src/system/output_linear_response.F90,
	  src/td/pes_mask.F90, src/td/pes_rc.F90: * fixed kpoint
	  parallelization related stuff

2009-03-25 12:42  nitsche

	* [r5111] src/td/td_calc.F90: * fixed issue due to kpoint
	  parallelization

2009-03-25 14:26  nitsche

	* [r5112] src/hamiltonian/lasers.F90, src/td/td_init.F90: * fixed
	  problem in laser_write_info, dt and max_iter were always zero for
	  non optimal control.
	  
	  Alberto, could you check if it is still as you intended it to be?

2009-03-26 02:06  dstrubbe

	* [r5113] src/main/run.F90, src/states/states.F90,
	  src/system/v_ks.F90: *) Some tweaks to documentation and comments
	  *) Now real wavefunctions are used for a periodic system if the
	  k-sampling is gamma-point only

2009-03-26 05:11  xavier

	* [r5114] src/hamiltonian/epot.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/include/global.h,
	  src/main/gcm.F90, src/main/one_shot.F90, src/main/static_pol.F90,
	  src/main/unocc_inc.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_multigrid.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/ground_state.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/states/elf.F90,
	  src/states/magnetic.F90, src/states/restart.F90,
	  src/states/states.F90, src/states/states_calc_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert_inc.F90,
	  src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/v_ks.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_x_inc.F90,
	  src/td/ob_rti.F90, src/td/td.F90, src/td/td_calc.F90,
	  src/td/td_rti.F90, src/td/td_write.F90, src/xc/axc.F90,
	  src/xc/vxc.F90: Removed the NP macro.

2009-03-26 09:11  xavier

	* [r5115] src/scf/eigen_lobpcg_inc.F90: Small cleaning of lobpcg.

2009-03-26 10:27  marques

	* [r5116] libxc/ChangeLog, libxc/Makefile.am, libxc/PACKAGING,
	  libxc/configure.ac, libxc/m4/acx.m4: Several details necessary to
	  package libxc.
	  *) There is now a PACKAGING file
	  *) FCCPP explanation now appears in ./configure --help
	  *) Automatic generation of ChangeLog file -- maybe it would be
	  better to
	  separate it per years, but I don't know how to do it well...

2009-03-26 14:45  nitsche

	* [r5118] src/scf/eigen.F90, src/states/restart.F90: *
	  eigensolver_run now works with k-point parallelization
	  * fixed issues within restart_write and restart_read (k-point
	  parallelization)

2009-03-26 16:39  nitsche

	* [r5119] src/basic/io.F90, src/basic/profiling.F90: * added some
	  missing pop_sub, cleanup

2009-03-26 16:42  nitsche

	* [r5120] src/grid/derivatives_inc.F90, src/grid/mesh_init.F90,
	  src/grid/par_vec_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/main/casida.F90, src/opt_control/opt_control.F90,
	  src/poisson/poisson.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/lcao.F90, src/species/ps.F90, src/species/ps_hgh.F90,
	  src/states/mix_inc.F90, src/td/cpmd.F90, src/td/ob_mem.F90,
	  src/td/td.F90, src/td/td_write.F90: * added more missing pop_sub,
	  cleanup

2009-03-26 21:04  xavier

	* [r5121] src/scf/eigen_lobpcg_inc.F90: The LOBPCG solver was
	  broken for StateBlockSize smaller than the total
	  number of vectors, this fixes the problem.

2009-03-26 21:28  xavier

	* [r5122] src/states/states_block_inc.F90: Added profiling regions
	  to state_compactify and states_uncompactify.

2009-03-27 03:08  xavier

	* [r5123] src/grid/mesh_function_inc.F90,
	  src/states/states_block.F90, src/states/states_block_inc.F90: The
	  states_blockt_mul routine now uses mf_dotp_batch instead of blas
	  for the multiplication (this is faster since the copies are
	  avoided).

2009-03-27 05:26  xavier

	* [r5124] src/scf/eigen_lobpcg_inc.F90, src/scf/subspace_inc.F90,
	  src/states/states_calc_inc.F90: * Improved the interface for
	  states_linear_combination.
	  * Replaced a blas abuse by a forall loop.

2009-03-27 10:31  xavier

	* [r5125] src/scf/eigen_lobpcg.F90, src/scf/eigen_lobpcg_inc.F90: *
	  Added a progress bar to the lobpcg eigensolver.

2009-03-27 11:12  nitsche

	* [r5126] src/basic/distributed.F90, src/ions/simul_box.F90,
	  src/math/tdfunction.F90, src/states/states.F90: * fixed some
	  missing pop_sub()
	  * ierr was not initialized in td_function which was the case when
	  function_name is not found inside a block
	  * distributed_nullify was not setting the default values in
	  mpi_grp, which triggered a bug when using different
	  parallelization strategies in successive runs

2009-03-27 12:55  nitsche

	* [r5127] src/states/restart.F90: * fixed problems of loading
	  restart information for open boundaries when in parallel mode

2009-03-27 22:18  dstrubbe

	* [r5128] testsuite/linear_response/02-h2o_pol_lr.test: Changed
	  slightly the results of the hyperpolarizability test to reflect
	  the new values from Miguel's new analytic version of the LDA Kxc
	  kernel.

2009-03-30 18:05  acastro

	* [r5129] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Removed some duplicated
	  variables, which were causing some
	  trouble. Also, removed the option of phase-and-envelope
	  optimization,
	  which was not coded properly. Eventually it should be put back.

2009-03-31 09:09  marques

	* [r5131] libxc/AUTHORS, libxc/NEWS, libxc/README,
	  libxc/src/lda_x.c: Little corrections to some stupid files

2009-03-31 09:29  marques

	* [r5133] libxc/ChangeLog, libxc/Makefile.am,
	  libxc/src/Makefile.am: A couple more fixes to the make
	  environment

2009-03-31 12:56  marques

	* [r5134] doc/html/vars/Makefile.am, src/basic/loct.F90,
	  src/basic/loct_inc.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers_inc.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/states/Makefile.am,
	  src/states/states.F90, src/system/preconditioners.F90,
	  src/td/td_write.F90: *) Fixed all errors reported by valgrind for
	  the morse test. This included a couple of
	  uninitialized variables and some memory leaks in states_copy
	  *) Fixed dependencies to be able to do make -j4

2009-03-31 13:18  marques

	* [r5135] src/basic/loct.F90, src/basic/loct_inc.F90,
	  src/hamiltonian/hamiltonian.F90, src/hamiltonian/lasers_inc.F90,
	  src/states/states.F90, src/td/td_write.F90: *) got rid of my
	  recently introduced loct_pointer_nullify, as the macro DEALLOC
	  does the same
	  *) fixed memory leak in hartree_fock calculations

2009-03-31 13:33  marques

	* [r5136] src/td/td.F90, src/td/td_write.F90: Removed record_length
	  from writing of gauge field. It works fine with my gfortran.
	  Xavier, please
	  check if it breaks something...

2009-04-01 09:06  acastro

	* [r5137] src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Changed a little how the
	  parametrization of the control functions is
	  done. Also, added more comments and documentation.

2009-04-01 10:18  nitsche

	* [r5138] src/hamiltonian/hamiltonian.F90,
	  src/states/states_calc_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/td.F90: * fixed problem in
	  states_calc_inc.F90 when compiling with MPI
	  * numerous fixes in order to get transport working in parallel
	  
	  The propagation itself now works in parallel. The calculation of
	  the green functions is still only done by the root node.

2009-04-01 13:40  xavier

	* [r5139] src/grid/Makefile.am, src/grid/cubic_mesh.F90,
	  src/grid/cubic_mesh.h, src/grid/cubic_mesh_fft.c,
	  src/grid/cubic_mesh_low.c: Added a file for fourier space
	  routines of cubic_mesh.

2009-04-01 23:55  acastro

	* [r5140] src/td/ob_rti.F90: Just one little problem with the 132
	  column length limit in some
	  compilers (gfortran, in my case).

2009-04-02 12:30  nitsche

	* [r5141] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/ob_lead.F90, src/scf/ground_state.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/Makefile.am,
	  src/states/ob_green.F90, src/states/states.F90: * the green
	  function calculation (for Lippmann-Schwinger) is now parallel

2009-04-02 12:44  nitsche

	* [r5142] src/states/states.F90: * bugfix for the last commit of me

2009-04-02 14:41  xavier

	* [r5143] src/grid/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/sternheimer_inc.F90: * When the system is
	  periodic, the r perturbation in Sternheimer is
	  now calculated as i d/dk. This makes the polarizability position
	  independent.
	  
	  * A build dependency was missing.

2009-04-03 05:03  xavier

	* [r5144] src/td/td_rti.F90: Parallelization in K points of the
	  time propagation.

2009-04-03 08:10  acastro

	* [r5145] src/opt_control/parameters.F90,
	  testsuite/optimal_control/04-box.test: Fix of a (small) bug in
	  the OCT part: when optimizing with fixed
	  fluence, the code was not using the fluence of the laser field
	  specified in the input file, but rather doing some
	  transformations on
	  this, and then computing the fluence. I had to change one test
	  value.

2009-04-03 09:33  xavier

	* [r5146] src/basic/profiling.F90: Memory profiling is now enable
	  separately of time profiling.

2009-04-03 12:34  xavier

	* [r5147] src/hamiltonian/hamiltonian_inc.F90: Phases for the k
	  points are now applied by blocks.

2009-04-03 12:39  xavier

	* [r5148] src/hamiltonian/hamiltonian_inc.F90: Some lines in my
	  last commit were too long.

2009-04-03 14:30  xavier

	* [r5149] src/sternheimer/kdotp.F90: Bugfix: out of bounds access
	  in kdotp.

2009-04-04 18:12  acastro

	* [r5150] src/opt_control/iter.F90, src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90: Solved some memory leaks
	  detected by valgrind.

2009-04-04 18:54  dstrubbe

	* [r5151] src/sternheimer/em_resp.F90: Missing variable
	  initialization added. Thanks to Tobias for catching this.

2009-04-05 15:23  xavier

	* [r5152] src/hamiltonian/epot.F90: The calculation of the dipole
	  for periodic systems didn't work for
	  real wave-functions. David, can you check my changes?

2009-04-05 16:31  xavier

	* [r5153] src/basic/io.F90, src/math/filters.F90,
	  testsuite/real_time/01-etrs.01-gs.inp,
	  testsuite/real_time/01-etrs.02-td.inp,
	  testsuite/real_time/01-etrs.03-td_lanczos.inp,
	  testsuite/real_time/01-etrs.test,
	  testsuite/real_time/02-aetrs.01-gs.inp,
	  testsuite/real_time/02-aetrs.02-td.inp,
	  testsuite/real_time/02-aetrs.03-td_lanczos.inp,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/03-exp_mid.01-gs.inp,
	  testsuite/real_time/03-exp_mid.02-td.inp,
	  testsuite/real_time/03-exp_mid.test,
	  testsuite/real_time/05-cpmd.01-gs.inp,
	  testsuite/real_time/05-cpmd.02-verlet.inp,
	  testsuite/real_time/05-cpmd.03-vel_verlet.inp,
	  testsuite/real_time/05-cpmd.test,
	  testsuite/real_time/07-visscher.01-gs.inp,
	  testsuite/real_time/07-visscher.02-td.inp,
	  testsuite/real_time/07-visscher.test: Enabled pseudopotential
	  filtering in several tests.

2009-04-05 16:35  xavier

	* [r5154] src/basic/io.F90, src/math/filters.F90: Commited this
	  changes by mistake.

2009-04-05 18:42  dstrubbe

	* [r5155] src/hamiltonian/epot.F90: Thanks Xavier for noticing the
	  problem with the single-point Berry's phase calculation when we
	  have real wavefunctions. Your fix made only diagonal elements be
	  calculated though; now it is corrected.

2009-04-05 22:05  acastro

	* [r5156] src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/check_input.F90, src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp: Added the
	  option of representing a control function (for the OCT part)
	  as a Fourier series, but without the constrain of keeping a fixed
	  fluence (up to now one could represent it as a Fourier series,
	  but
	  always doing a fixed-fluence search).

2009-04-05 22:28  acastro

	* [r5157] src/hamiltonian/epot.F90: There was one extra parenthesis
	  that prevented the compilation.

2009-04-06 07:10  xavier

	* [r5158] src/species/ps.F90: HGH pseudopotentials set the l of the
	  local component to -1, this
	  caused the filtering to fail. So I changed l_loc to 0, But I am
	  not
	  sure if this correct or not.

2009-04-06 13:16  xavier

	* [r5159] src/species/ps.F90: My previous commit was wrong. Wow
	  l_loc = 0 is only used in HGH for
	  the filtering of the local part.

2009-04-06 15:49  xavier

	* [r5160] src/scf/eigen_rmmdiis_inc.F90: I started to reimplement
	  the diis solver based on the vasp paper.

2009-04-06 16:32  nitsche

	* [r5161] src/grid/ob_interface.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/states/restart.F90, src/states/states.F90,
	  src/system/output_states.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90: * corrected the (huge) overhead for open
	  boundaries due to the gs periodic run, now the speed of the
	  previous version is reached
	  * bug in h_sys_output_current_flow (k-points and states
	  parallelization)
	  * info for lead potentials can now show longer formulas
	  * corrected push_sub call (wrong name)

2009-04-06 16:47  xavier

	* [r5162] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: * The
	  DIIS iteration now ends with a trial move.
	  * The default number of iterations is now 3 (the recommended
	  value).

2009-04-07 09:56  xavier

	* [r5163] src/hamiltonian/species_pot.F90, src/math/filters.F90,
	  src/species/ps.F90: Now atomic orbitals are also passed by
	  filter, this improves a bit the
	  quality of the LCAO.

2009-04-08 10:02  xavier

	* [r5164] src/opt_control/parameters.F90: OCT runs fail with g95,
	  it seems that this is caused by a compiler
	  bug. Now octopus stops with an error in this case.

2009-04-08 12:14  xavier

	* [r5165] src/hamiltonian/species_pot.F90, src/math/filters.F90,
	  src/species/ps.F90: I remove the filtering of atomic orbitals, I
	  will put it back after
	  releasing.

2009-04-08 12:36  xavier

	* [r5166] src/ions/vibrations.F90,
	  testsuite/linear_response/04-vib_modes.test: The output of the
	  vibrational modes test did not have a fixed format,
	  this caused the test to fail for some compilers.

2009-04-08 13:12  xavier

	* [r5167] testsuite/linear_response/03-vdw_sternheimer.test:
	  Updated the value for the VdW tests, now it is passed by the four
	  compilers I tried. The difference was quite small (0.0002).

2009-04-08 13:16  marques

	* [r5168] src/basic/loct_inc.F90, src/grid/derivatives.F90,
	  src/grid/nl_operator.F90, src/grid/stencil.F90: Fixed the long
	  standing memory leak when running with curvilinear coordinates.
	  Please be very careful next time you use _copy routines!!!!
	  
	  -This line, and those below, will be ignored--
	  
	  M src/basic/loct_inc.F90
	  M src/grid/derivatives.F90
	  M src/grid/stencil.F90
	  M src/grid/nl_operator.F90

2009-04-08 14:30  marques

	* [r5169] src/main/casida.F90: I belive that I fixed a couple of
	  memory leaks in casida. I am not sure, that I caught them all and
	  that I did not introduce further bugs. Let's wait for buildbot...

2009-04-08 14:53  marques

	* [r5170] src/states/linear_response.F90, src/sternheimer/vdW.F90:
	  Now the memory leaks in vdW were corrected. There is a bit of a
	  problem with the DEALLOC macro that only works for pointers. I
	  think we should have a macro for pointers and another for
	  allocatable arrays. I will think about it after the release...

2009-04-08 14:59  mjv500

	* [r5171] src/ions/crystal.F90: output format bugs for MAXDIM not 3

2009-04-08 15:01  mjv500

	* [r5172] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/states/density_matrix.F90: 4D output improvements

2009-04-08 15:15  marques

	* [r5173] src/basic/oct_f.c, src/grid/index.F90,
	  src/grid/mesh_function_inc.F90, src/ions/crystal.F90,
	  src/ions/simul_box.F90, src/math/root_solver.F90: Some compiler
	  warnings fixed

2009-04-09 18:19  xavier

	* [r5174] src/scf/lcao.F90, src/scf/lcao_inc.F90: Parallelization
	  in k points of LCAO: the eigenvalues are now
	  allgathered.

2009-04-09 18:32  xavier

	* [r5175] src/states/ksinversion.F90: Removed a ' from comments.

2009-04-09 18:37  micael

	* [r5176] liboct_parser/Makefile.am: string_f.h was not included in
	  the distribution, although I'm not sure this is the correct way
	  of fixing it.

2009-04-09 18:41  micael

	* [r5177] liboct_parser/Makefile.am: Wrong filename...

2009-04-09 22:05  xavier

	* [r5178] src/basic/units.F90, src/ions/ion_interaction.F90,
	  src/ions/simul_box.F90, src/ions/solids.F90,
	  src/opt_control/parameters.F90, src/species/atomic.F90,
	  src/species/ps_hgh.F90, src/species/ps_psf.F90,
	  src/utils/phonon_spectrum.F90: Tobias' patch: several literals
	  were defined without the proper
	  precision.

2009-04-10 06:13  xavier

	* [r5179] src/scf/scf.F90: K point parallelization: Angular
	  momentum information is now
	  allgathered.

2009-04-10 06:36  xavier

	* [r5180] src/states/states_calc_inc.F90: Bugfix: static arrays
	  should have dimensions known at compilation
	  time.
	  
	  Please be careful with this.

2009-04-10 07:02  xavier

	* [r5181] src/states/states_calc_inc.F90: Parallelization in k
	  points: now momemtum is allgathered.

2009-04-10 07:17  xavier

	* [r5182] src/basic/calc_mode.F90: Restricted parallelization modes
	  for the release: only the ground
	  state is parallelizable in k points (the rest hasn't been tested)
	  and
	  only the time propagation is parallel in states.

2009-04-10 12:40  acastro

	* [r5183] src/grid/hypercube.F90, src/grid/index.F90: Bug fix: for
	  lower dimensional cases, the functions were not printed
	  properly by the "output_function" routines, because of an
	  intent(out)
	  argument that was not set to zero as it should.

2009-04-10 12:49  xavier

	* [r5184] src/basic/messages.F90, src/scf/eigen.F90, src/td/td.F90,
	  testsuite/finite_systems_3d/20-eigensolver.06-rmmdiis.inp,
	  testsuite/periodic_systems/05-lithium.02-td.inp,
	  testsuite/periodic_systems/05-lithium.03-td-restart.inp: * Added
	  the function messages_devel_version to mark code that should
	  be used only in development mode.
	  
	  * Restricted time propagation for solids to development mode.
	  
	  * Restricted the rmmdiis eigensolver to development mode.

2009-04-10 15:06  xavier

	* [r5185] testsuite/finite_systems_3d/24-o2-spin.01-gs.inp,
	  testsuite/finite_systems_3d/24-o2-spin.test,
	  testsuite/finite_systems_3d/Makefile.am: Added a test for
	  parallelization over spin.

2009-04-11 07:26  xavier

	* [r5186] testsuite/finite_systems_1d/01-hydrogen.test,
	  testsuite/finite_systems_1d/02-neon_mpi.test,
	  testsuite/finite_systems_1d/09-morse.test,
	  testsuite/finite_systems_2d/01-quadratic_box.test,
	  testsuite/finite_systems_2d/02-fock-darwin.test,
	  testsuite/finite_systems_2d/03-helium_atom.test,
	  testsuite/finite_systems_2d/04-biot_savart.test,
	  testsuite/finite_systems_2d/05-spin_precession.test,
	  testsuite/finite_systems_2d/06-tdmagnetic.test,
	  testsuite/finite_systems_2d/07-hartree_fock.test,
	  testsuite/finite_systems_3d/01-carbon_atom.test,
	  testsuite/finite_systems_3d/02-curvlinear_coordinates.test,
	  testsuite/finite_systems_3d/03-functionals.test,
	  testsuite/finite_systems_3d/04-jellium.test,
	  testsuite/finite_systems_3d/05-multigrid_solver.test,
	  testsuite/finite_systems_3d/06-restart.test,
	  testsuite/finite_systems_3d/07-spin_orbit_coupling.test,
	  testsuite/finite_systems_3d/08-spin_orbit_coupling_full.test,
	  testsuite/finite_systems_3d/09-spinors.test,
	  testsuite/finite_systems_3d/11-sic.test,
	  testsuite/finite_systems_3d/12-forces.test,
	  testsuite/finite_systems_3d/13-full_potential_hydrogen.test,
	  testsuite/finite_systems_3d/15-hartree.test,
	  testsuite/finite_systems_3d/16-isf_solver.test,
	  testsuite/finite_systems_3d/18-current.test,
	  testsuite/finite_systems_3d/19-laser.test,
	  testsuite/finite_systems_3d/20-eigensolver.test,
	  testsuite/finite_systems_3d/21-lobpcg.test,
	  testsuite/finite_systems_3d/22-time_propagation.test,
	  testsuite/finite_systems_3d/23-go-na2.test,
	  testsuite/linear_response/01-casida.test,
	  testsuite/linear_response/02-h2o_pol_lr.test,
	  testsuite/linear_response/03-vdw_sternheimer.test,
	  testsuite/linear_response/04-vib_modes.test,
	  testsuite/linear_response/05-polarizability.test,
	  testsuite/oct-run_regression_test.pl,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.test,
	  testsuite/optimal_control/01-asym_doublewell.test,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.test,
	  testsuite/optimal_control/06-zbr98.test,
	  testsuite/periodic_systems/01-free_electrons.test,
	  testsuite/periodic_systems/02-cosine_potential.test,
	  testsuite/periodic_systems/03-sodium_chain.test,
	  testsuite/periodic_systems/04-silicon.test,
	  testsuite/periodic_systems/05-lithium.test,
	  testsuite/real_time/01-etrs.test,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/03-exp_mid.test,
	  testsuite/real_time/04-etrs_single.test,
	  testsuite/real_time/05-cpmd.test,
	  testsuite/real_time/07-visscher.test: The test files had several
	  fields that are not used so I removed them
	  (many of these fields were outdated anyway).

2009-04-11 07:39  xavier

	* [r5187] testsuite/periodic_systems/05-lithium.01-gs.inp,
	  testsuite/periodic_systems/05-lithium.test: Enabled k point
	  parallelization of the lithium test.

2009-04-11 08:03  xavier

	* [r5188] src/sternheimer/sternheimer.F90: Restricted Sternheimer
	  for periodic system to development version.

2009-04-11 09:51  xavier

	* [r5189] src/grid/curvlinear.F90, src/grid/double_grid.F90,
	  src/grid/double_grid_apply.F90, src/grid/nl_operator.F90,
	  src/system/v_ks.F90, src/system/xc_OEP.F90: Replaced all checks
	  for conf%devel_version by calls to
	  messages_devel_version.

2009-04-11 15:12  xavier

	* [r5190] src/sternheimer/sternheimer.F90: Preorthogonalization is
	  only enabled if semiconductor smearing is
	  used. This fixes the polarizability test.

2009-04-11 15:32  xavier

	* [r5191] src/system/preconditioners.F90: Sometimes the filter
	  preconditioner gives problems for periodic
	  systems, so it is now disabled in that case.

2009-04-11 15:54  xavier

	* [r5192]
	  testsuite/finite_systems_3d/01-carbon_atom.03-ground_state_double_grid.inp:
	  This test has to run as DevelVersion.

2009-04-11 16:02  xavier

	* [r5193] src/ions/ion_dynamics.F90: Restricted the (half
	  implemented) Nose-Hoover thermostat to the
	  development version.

2009-04-11 16:52  xavier

	* [r5194] src/grid/mesh_function_inc.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  Bugfix: the Biot Savart test did not work in parallel.

2009-04-12 05:20  dstrubbe

	* [r5195] src/sternheimer/em_resp.F90: *) Previous formulation of
	  hyper-Rayleigh scattering (HRS) hyperpolarizabilities implicitly
	  assumed Kleinman symmetry (permutation of indices). Now I have
	  generalized the equations, as is needed for the non-static case.
	  *) HRS hyperpolarizability is now properly computed as a complex
	  number rather than a real number, since it can be complex when
	  omega or eta is nonzero.
	  *) Noted that these HRS hyperpolarizabilities apply only to the
	  liquid or gas phase, where there is no long-range order so
	  orientations are uncorrelated and isotropic. In a crystal, the
	  tensor components of beta would be used directly to study HRS.

2009-04-12 08:27  acastro

	* [r5196] src/opt_control/propagation.F90, src/system/v_ks.F90,
	  src/td/td_rti.F90: A few details:
	  o Eliminated one long-standing memory leak that
	  appeared in OCT runs.
	  o One line was too long for compiler for compilers restricted
	  with the 132 columns rule.
	  o One uninitialized variable.

2009-04-12 20:03  dstrubbe

	* [r5197] src/sternheimer/em_resp.F90: *) Reorganized subroutines
	  in em_resp to undo an unnecessary change I made a while ago
	  *) Hyperpolarizability beta file was being written for the
	  frequency corresponding to each factor, which is misleading since
	  it only corresponds to one frequency, and could also cause extra
	  confusion by overwriting previous beta files in a calculation
	  with multiple frequencies. Now it is written only for the first
	  factor, and the documentation says so.
	  *) The wavefunctions and circular dichroism files were being
	  written to a directory labelled by the frequency (without the
	  factors), which is incorrect since they are actually calculated
	  for the frequency times the factors. Now they are written for
	  each factor in the appropriate directories.

2009-04-12 21:51  dstrubbe

	* [r5198] src/main/main.F90, src/opt_control/target.F90,
	  src/scf/scf.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90: *) Noted in documentation runs that
	  are development-only.
	  *) Added variable to enable calculation of Born charges, so that
	  this can be marked development-only.
	  *) Broke up a line that was too long and preventing compilation
	  in some builds
	  *) Marked kdotp run as development-only: I am pretty confident
	  about the k.p wavefunctions, but the effective masses have some
	  problems, and k.p is only useful for periodic em_resp which is
	  development-only anyway.
	  *) Added geometry to output_function calls in opt_control/target
	  so that XCrySDen output format can be used.
	  *) Explained warning on single-point Berry's phase for multiple
	  k-points more.

2009-04-13 07:25  xavier

	* [r5199] testsuite/linear_response/01-casida.test: Enabled the
	  casida test in parallel.

2009-04-13 08:26  xavier

	* [r5200] src/grid/io_function_inc.F90,
	  src/grid/mesh_function_inc.F90, src/hamiltonian/hamiltonian.F90,
	  src/ions/simul_box.F90, src/main/casida.F90,
	  src/poisson/poisson_cutoffs.c, src/scf/eigen.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/states/density_matrix.F90,
	  src/states/ksinversion.F90, src/states/restart.F90,
	  src/states/states.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/kdotp.F90, src/system/v_ks.F90,
	  src/td/ob_rti.F90, src/utils/harmonic_spectrum.F90: Removed
	  several unused variables.

2009-04-13 09:02  xavier

	* [r5201] src/ions/simul_box.F90, src/main/gcm.F90,
	  src/main/main.F90, src/sternheimer/raman.F90: Restricted some
	  parts to developmente version:
	  
	  * Open boundaries
	  * Raman
	  * GCM

2009-04-13 22:25  xavier

	* [r5202] libxc/Makefile.am, share/Makefile.am: This fixes the
	  problem with make distcheck.

2009-04-13 22:35  xavier

	* [r5203] src/scf/lcao_inc.F90: A line was too long.

2009-04-14 07:41  marques

	* [r5204] share/Makefile.am: Xavier, your change deleted some
	  distributed files when performing make distcheck. This should
	  correct it.

2009-04-14 08:25  marques

	* [r5205] share/Makefile.am: Another try at the distcheck problem

2009-04-14 09:49  xavier

	* [r5206] src/hamiltonian/ob_lead.F90: Bugfix: A non-initialized
	  variable.

2009-04-14 10:22  xavier

	* [r5207] src/species/atomic.F90, src/species/ps_psf.F90,
	  src/td/ob_rti.F90: Fixed some compiler warnings.

2009-04-14 13:12  xavier

	* [r5208] ChangeLog, Makefile.am, PACKAGING, doc/ChangeLog.2001.gz,
	  doc/ChangeLog.2002.gz, doc/ChangeLog.2003.gz,
	  doc/ChangeLog.2004.gz, doc/ChangeLog.2005.gz,
	  doc/ChangeLog.2006.gz, doc/ChangeLog.2007.gz,
	  doc/ChangeLog.2008.gz, doc/Makefile.am: Added ChangeLog and
	  PACKAGING files.

2009-04-14 13:32  xavier

	* [r5209] src/opt_control/opt_control.F90, src/scf/scf.F90,
	  testsuite/optimal_control/01-asym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/01-asym_doublewell.02-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.03-oct_run.inp,
	  testsuite/optimal_control/02-sym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/02-sym_doublewell.02-unocc.inp,
	  testsuite/optimal_control/02-sym_doublewell.03-oct.inp,
	  testsuite/optimal_control/03-localtarget.01-gs.inp,
	  testsuite/optimal_control/03-localtarget.02-oct.inp,
	  testsuite/optimal_control/03-localtarget.03-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/04-box.01-ground_state.inp,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/05-adw.01-ground_state.inp,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/06-zbr98.01-ground_state.inp,
	  testsuite/optimal_control/06-zbr98.02-oct.inp: * Added a warning
	  about angular momentum and non-local pseudos.
	  * Put optimal control as DevelVersion (it gives problems with
	  some
	  compilers).

2009-04-14 13:45  xavier

	* [r5210] debian/control, debian/rules: Updated the debian scripts.

2009-04-14 13:48  xavier

	* [r5211] configure.ac, debian/changelog: * Changed version to
	  3.1.0.

2009-04-14 14:37  xavier

	* [r5213] share/Makefile.am: Bugfix: some files in share/ were not
	  copied to the build directory.

2009-04-14 15:18  marques

	* [r5216] src/basic/distributed.F90, src/basic/loct_inc.F90,
	  src/basic/mpi_lib_inc.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/nl_operator.F90,
	  src/grid/stencil.F90, src/hamiltonian/epot.F90,
	  src/hamiltonian/hamiltonian.F90, src/include/global.h,
	  src/main/casida.F90, src/states/linear_response.F90,
	  src/states/states.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/td_write.F90: Started building a more
	  comprehensive memory profiling system

2009-04-14 16:01  xavier

	* [r5217] src/include/global.h: Fixes the problem with deallocation
	  macros.

2009-04-14 17:54  xavier

	* [r5218] src/basic/mpi_lib_inc.F90: Fixes compilation in parallel.

2009-04-14 19:39  xavier

	* [r5219] src/basic/multicomm.F90: Bugfix: xlf returns 1 as number
	  of threads inside omp master.

2009-04-14 21:53  xavier

	* [r5221] src/basic/multicomm.F90: My last commit was wrong, it was
	  a problem with libraries.

2009-04-14 22:02  acastro

	* [r5222] src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90,
	  src/opt_control/parameters.F90, src/opt_control/propagation.F90:
	  Added the usual conjugate gradients method as an optimization
	  algorithm for QOCT.

2009-04-14 23:36  acastro

	* [r5223] src/hamiltonian/hamiltonian.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/td/td_rti.F90: QOCT with time-dependent targets was not
	  working, since I don't know
	  when. I have put it back to work (I think), although some more
	  testing
	  is needed.
	  
	  In order to make it work, I added the option of using
	  Crank-Nicholson
	  as time propagator, without using the SPARSKIT package to solve
	  the
	  linear system -- instead I use the QMR solver. The reason is (1)
	  that
	  I was finding this latter option very slow, and (2) it would be
	  nice
	  to have Crank-Nicholson without depending on SPARSKIT anyway.
	  
	  For open-boundaries calculations (transport), the Crank-Nicholson
	  with
	  the QMR solver is used also. It would be nice to unify the two
	  procedures.

2009-04-15 12:44  mjv500

	* [r5224] src/grid/derivatives.F90, src/states/Makefile.am,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_states.F90, src/system/system.F90: derivatives
	  now use modelMB structure masses

2009-04-15 12:48  mjv500

	* [r5225] src/states/density_matrix.F90,
	  src/system/output_states.F90: removed argument for
	  write_density_matrix

2009-04-15 13:10  marques

	* [r5226] src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function_inc.F90, src/grid/curv_modine.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/derivatives_inc.F90, src/grid/double_grid.F90,
	  src/grid/double_grid_apply.F90, src/grid/fourier_space_inc.F90,
	  src/grid/grid.F90, src/grid/gridhier_inc.F90,
	  src/grid/hypercube.F90, src/grid/io_function_inc.F90,
	  src/grid/mesh.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/grid/nl_operator.F90, src/grid/ob_interface.F90,
	  src/grid/par_vec.F90, src/grid/par_vec_inc.F90,
	  src/grid/scalar_mesh.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_variational.F90, src/grid/submesh.F90,
	  src/grid/submesh_inc.F90, src/hamiltonian/em_field.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/lasers_inc.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/ions/geometry.F90,
	  src/ions/ion_dynamics.F90, src/ions/simul_box.F90,
	  src/ions/symmetries.F90, src/ions/vibrations.F90,
	  src/ions/xyz_file.F90, src/main/casida.F90,
	  src/main/casida_inc.F90, src/main/gcm.F90, src/main/geom_opt.F90,
	  src/main/one_shot.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/math/fftw3.F90,
	  src/math/lalg_adv_lapack.F90, src/math/math.F90,
	  src/math/math_inc.F90, src/math/ode_solver_inc.F90,
	  src/math/root_solver.F90, src/math/root_solver_inc.F90,
	  src/math/solvers_inc.F90, src/math/sparskit_inc.F90,
	  src/math/splines.F90, src/math/tdfunction.F90,
	  src/opt_control/filters.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_1D.F90, src/poisson/solver_2D.F90,
	  src/scf/eigen.F90, src/scf/eigen_cg_inc.F90,
	  src/scf/eigen_evolution_inc.F90, src/scf/eigen_lobpcg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/species/atomic.F90,
	  src/species/logrid.F90, src/species/ps.F90,
	  src/species/ps_cpi.F90, src/species/ps_cpi_file.F90,
	  src/species/ps_fhi.F90, src/species/ps_hgh.F90,
	  src/species/ps_in_grid.F90, src/species/ps_psf.F90,
	  src/species/ps_psf_file.F90, src/species/ps_upf.F90,
	  src/species/species.F90, src/states/density_matrix.F90,
	  src/states/elf.F90, src/states/excited_states.F90,
	  src/states/excited_states_inc.F90, src/states/ksinversion.F90,
	  src/states/linear_response_inc.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/mix_inc.F90,
	  src/states/modelmb_particles.F90, src/states/ob_green.F90,
	  src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_block_inc.F90,
	  src/states/states_calc.F90, src/states/states_calc_inc.F90,
	  src/states/states_dim.F90, src/states/states_kpoints.F90,
	  src/sternheimer/em_resp.F90, src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/phonons_lr.F90, src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/system/energy_inc.F90, src/system/exponential.F90,
	  src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_KLI_inc.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/td/cpmd.F90,
	  src/td/cpmd_inc.F90, src/td/ob_mem.F90, src/td/ob_rti.F90,
	  src/td/ob_src.F90, src/td/pes_mask.F90, src/td/pes_rc.F90,
	  src/td/spectrum.F90, src/td/td.F90, src/td/td_calc.F90,
	  src/td/td_rti.F90, src/td/td_write.F90, src/utils/broad.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90,
	  src/xc/axc.F90, src/xc/fxc.F90, src/xc/kxc.F90, src/xc/vxc.F90:
	  Replaced all deallocates by safe versions

2009-04-15 13:18  mjv500

	* [r5227] src/states/modelmb_particles.F90: fixed default modelMB
	  values

2009-04-15 13:23  marques

	* [r5228] src/system/exponential_split.F90: I hope this fixes the
	  compilation problem with buildbot

2009-04-15 13:50  marques

	* [r5229] src/system/exponential_split.F90: Forgot this one...

2009-04-15 13:52  marques

	* [r5230] src/basic/profiling.F90, src/basic/string.F90,
	  src/include/global.h: I have to leave, but Xavier promised to
	  clean this tuff ;)

2009-04-15 14:17  xavier

	* [r5231] src/td/ob_rti.F90: This should fix compilation with g95.

2009-04-15 14:56  xavier

	* [r5232] src/basic/profiling.F90, src/grid/scalar_mesh.F90,
	  src/include/global.h: * Now profiling_space is used to call
	  memory profiling functions.
	  * Scalar mesh did not use profiling_m.

2009-04-15 15:07  mjv500

	* [r5233] .: make svn ignore bin directory

2009-04-15 15:56  xavier

	* [r5234] src/basic/profiling.F90: Improved the memory profiling
	  output.

2009-04-15 16:09  xavier

	* [r5235] src/basic/profiling.F90: Added a mode of full memory
	  profiling.

2009-04-15 16:16  acastro

	* [r5236] src/grid/io_function_inc.F90, src/math/sparskit_inc.F90:
	  A couple of SAFE_DEALLOCATE issues that prevented compilation.

2009-04-15 16:22  acastro

	* [r5237] src/opt_control/opt_control.F90, src/td/td_rti.F90: Some
	  more SAFE_DEALLOCATE problems when compiling.

2009-04-15 16:44  acastro

	* [r5238]
	  testsuite/optimal_control/01-asym_doublewell.01-ground_state.inp,
	  testsuite/optimal_control/01-asym_doublewell.02-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.03-oct_run.inp,
	  testsuite/optimal_control/01-asym_doublewell.test,
	  testsuite/optimal_control/02-sym_doublewell.03-oct.inp,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.01-gs.inp,
	  testsuite/optimal_control/03-localtarget.02-oct.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.01-ground_state.inp,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/05-adw.test,
	  testsuite/optimal_control/06-zbr98.test: Small modifications to
	  the QOCT tests input files, so that they run
	  much faster.

2009-04-15 20:00  xavier

	* [r5239] src/grid/Makefile.am, src/grid/curvilinear.F90,
	  src/grid/curvlinear.F90, src/grid/derivatives.F90,
	  src/grid/double_grid.F90, src/grid/grid.F90,
	  src/grid/gridhier.F90, src/grid/mesh.F90,
	  src/grid/mesh_function_inc.F90, src/grid/mesh_init.F90,
	  src/grid/multigrid.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/poisson/poisson.F90,
	  src/poisson/poisson_multigrid.F90, src/states/restart.F90,
	  src/states/states_block_inc.F90, src/states/states_calc_inc.F90,
	  src/system/preconditioners.F90: curvlinear -> curvilinear

2009-04-15 20:31  xavier

	* [r5240] src/grid/curv_gygi.F90, src/grid/curvilinear.F90: The
	  curv_gygi module now copies the atomic coordinates, instead of
	  using the geometry object at each call.

2009-04-15 21:00  xavier

	* [r5241] src/grid/curv_modine.F90, src/grid/curvilinear.F90,
	  src/grid/mesh_init.F90, src/hamiltonian/species_pot.F90: Now
	  curvilinear coordinates only require the geometry at
	  initialization.

2009-04-16 07:51  xavier

	* [r5242] src/grid/grid.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/states/restart.F90: Included a pointer to the curvilinear
	  coordinates in the mesh.

2009-04-16 09:12  xavier

	* [r5243] src/grid/mesh_init.F90: My last commit broke Compilation
	  in parallel.

2009-04-16 09:29  marques

	* [r5244] src/basic/profiling.F90, src/grid/curvilinear.F90,
	  src/grid/mesh.F90, src/grid/nl_operator_inc.F90,
	  src/grid/submesh.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/species_pot.F90, src/ions/geometry.F90,
	  src/math/splines.F90, src/scf/lcao_inc.F90,
	  src/species/logrid.F90, src/species/ps_psf.F90,
	  src/species/species.F90, src/states/mix_inc.F90,
	  src/states/states_calc_inc.F90: Many, many allocates were
	  missing. I caught a lot of them, by using the carbon atom test. I
	  will run other tests now, and try to sort out the rest of the
	  allocates...

2009-04-16 10:33  marques

	* [r5245] src/basic/mpi.F90, src/grid/grid.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90,
	  src/math/splines.F90, src/states/states.F90: Removed all
	  assignment(=) from octopus. Overloading operators is a very bad
	  thing to do, as it makes impossible to grep where the assignments
	  are made. This can lead to bugs that are extraordinarely hard to
	  find. In any case, we do not really use the assignments. Call the
	  _copy routine explicitly from now on, please.

2009-04-16 10:43  xavier

	* [r5246] src/grid/io_function_inc.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90, src/poisson/solver_1D.F90,
	  src/poisson/solver_2D.F90: Defined the mesh_x_global function,
	  that will replace mesh%x_global.

2009-04-16 11:02  marques

	* [r5247] src/species/ps.F90, src/species/ps_hgh.F90: Another
	  couple of variables that were not deallocated.
	  I introduced a GOTO statement in octopus ;) I hope you don't kill
	  me. Actually I do think we can use them in cases as this: there
	  was if(something) dealloc a couple o stuff; pop_sub; exit, which
	  is again very prone to errors. I replaced it by a goto 999, where
	  999 is before the final deallocs of the routine. This is, I
	  thinkl, but cleaner, and therefore I give green light that it
	  becomes common practice in octopus...

2009-04-16 13:04  nitsche

	* [r5248]
	  testsuite/open_systems/01-wavepacket.01-deriv_order_1.inp,
	  testsuite/open_systems/01-wavepacket.02-deriv_order_4.inp,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.01-full_q.inp,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/03-extended_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.test: * enabled
	  the open boundary tests (MPI is not working due to changes for
	  version 3.1.0)
	  
	  Is there a way to disable the tests just for MPI? Now it will
	  just stop with an error message.
	  I am trying hard to parallelize the transport mode (gs + td) in
	  k-points...

2009-04-16 13:15  xavier

	* [r5249] src/grid/mesh_function_inc.F90: Now interpolate functions
	  do not require mesh%x_global (they create a
	  local copy).

2009-04-16 14:40  xavier

	* [r5250] src/grid/mesh.F90: Now mesh_x_global calculates the value
	  instead of using mesh%x_global.

2009-04-16 15:19  xavier

	* [r5251] src/grid/mesh.F90, src/grid/mesh_init.F90: Removed
	  mesh::x_global.

2009-04-16 16:42  xavier

	* [r5252] src/grid/mesh.F90: I had forgotten to remove the x_global
	  component of mesh.

2009-04-16 16:44  acastro

	* [r5253] src/basic/distributed.F90, src/basic/multicomm.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/hamiltonian.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90, src/main/run.F90,
	  src/states/states.F90, src/states/states_dim.F90: Added default
	  initialization to NULL() of the pointers included in
	  several data types. This allows calling "associated(x)" without
	  crashing.
	  
	  In the way, I found one copy of a geometry type variable through
	  the
	  previously overloaded "=", which should be done now with
	  "geometry_copy". This caused
	  open_systems/03-extended_eigenstate.test
	  to fail in my machine; now it still fails, but due to something
	  else.

2009-04-17 09:39  xavier

	* [r5254] src/basic/profiling.F90, src/include/global.h: The memory
	  profiling now also prints the size of the allocation.

2009-04-17 11:06  xavier

	* [r5255] configure.ac, src/basic/profiling.F90,
	  src/include/global.h, src/system/exponential_split.F90: The size
	  of allocations is now correctly calculated thanks to the
	  sizeof intrinsic. Since sizeof is not standard Fortran I included
	  a
	  autoconf macro to detect it (all the compilers I have tried
	  support
	  it, though).

2009-04-17 11:11  xavier

	* [r5256] m4/fc_sizeof.m4: I forgot a file.

2009-04-17 12:56  marques

	* [r5257] libxc/ChangeLog, libxc/Makefile.am, libxc/configure.ac,
	  libxc/m4/acx.m4, libxc/m4/fcflags.m4, libxc/src/Makefile.am,
	  libxc/src/functionals.c, libxc/src/get_funcs.pl, libxc/src/gga.c,
	  libxc/src/gga_c_am05.c, libxc/src/gga_c_lm.c,
	  libxc/src/gga_c_lyp.c, libxc/src/gga_c_p86.c,
	  libxc/src/gga_c_pbe.c, libxc/src/gga_c_pw91.c,
	  libxc/src/gga_perdew.c, libxc/src/gga_x_2d_b86_mgc.c,
	  libxc/src/gga_x_am05.c, libxc/src/gga_x_b86.c,
	  libxc/src/gga_x_b86_mgc.c, libxc/src/gga_x_b88.c,
	  libxc/src/gga_x_bayesian.c, libxc/src/gga_x_dk87.c,
	  libxc/src/gga_x_ft97.c, libxc/src/gga_x_g96.c,
	  libxc/src/gga_x_lg93.c, libxc/src/gga_x_mpbe.c,
	  libxc/src/gga_x_optx.c, libxc/src/gga_x_pbe.c,
	  libxc/src/gga_x_pbea.c, libxc/src/gga_x_pw86.c,
	  libxc/src/gga_x_pw91.c, libxc/src/gga_x_rpbe.c,
	  libxc/src/gga_x_wc.c, libxc/src/gga_xc_1w.c,
	  libxc/src/gga_xc_b97.c, libxc/src/gga_xc_edf1.c,
	  libxc/src/gga_xc_lb.c, libxc/src/gga_xc_xlyp.c,
	  libxc/src/hyb_gga.c, libxc/src/hyb_gga_xc_b1wc.c,
	  libxc/src/hyb_gga_xc_b3lyp.c, libxc/src/hyb_gga_xc_b97.c,
	  libxc/src/hyb_gga_xc_o3lyp.c, libxc/src/hyb_gga_xc_pbeh.c,
	  libxc/src/lca.c, libxc/src/lca_lch.c, libxc/src/lca_omc.c,
	  libxc/src/lda.c, libxc/src/lda_c_1d_csc.c,
	  libxc/src/lda_c_2d_amgb.c, libxc/src/lda_c_2d_prm.c,
	  libxc/src/lda_c_hl.c, libxc/src/lda_c_pw.c, libxc/src/lda_c_pz.c,
	  libxc/src/lda_c_rpa.c, libxc/src/lda_c_vwn.c,
	  libxc/src/lda_c_wigner.c, libxc/src/lda_c_xalpha.c,
	  libxc/src/lda_x.c, libxc/src/lda_x_2d.c,
	  libxc/src/lda_xc_teter93.c, libxc/src/libxc_master.F90,
	  libxc/src/mgga.c, libxc/src/mgga_c_tpss.c,
	  libxc/src/mgga_x_lta.c, libxc/src/mgga_x_m06l.c,
	  libxc/src/mgga_x_tau_hcth.c, libxc/src/mgga_x_tpss.c,
	  libxc/src/mgga_xc_vsxc.c, libxc/src/mix_func.c,
	  libxc/src/special_functions.c, libxc/src/string_f.h,
	  libxc/src/test.c, libxc/src/util.c, libxc/src/util.h,
	  libxc/src/work_gga_becke.c, libxc/src/work_gga_x.c,
	  libxc/src/work_gga_x_2d.c, libxc/src/work_lda.c,
	  libxc/src/work_mgga_c.c, libxc/src/work_mgga_x.c, libxc/src/xc.h,
	  libxc/src/xc_f.c, libxc/src/xc_s.h, libxc/testsuite/Makefile.am,
	  libxc/testsuite/xc-consistency.c, libxc/testsuite/xc-get_data.c,
	  libxc/testsuite/xc-reference.pl,
	  libxc/testsuite/xc-run_testsuite: Changed the license with the
	  script that Tobias sent. Thanks Tobias.

2009-04-17 13:16  xavier

	* [r5258] src/include/global.h: The sizeof intrinsic gives problems
	  with some compilers, so I will
	  disable its use while I find a way to fix it.

2009-04-17 14:02  xavier

	* [r5259] src/scf/eigen.F90, src/scf/eigen_rmmdiis.F90,
	  src/scf/eigen_rmmdiis_inc.F90: Now the DIIS eigensolver does a
	  steepest descent reduction in the
	  first step.

2009-04-17 14:30  xavier

	* [r5260] src/scf/eigen_rmmdiis_inc.F90: The steepest descent steps
	  in DIIS are now preconditioned.

2009-04-17 15:39  xavier

	* [r5261] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: Fixed
	  some errors in the DIIS start iteration.

2009-04-17 17:24  xavier

	* [r5262] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90:
	  Reorganized a bit the diis code.

2009-04-17 17:53  xavier

	* [r5263] src/scf/eigen_rmmdiis_inc.F90: More improvements to the
	  diis code, now I removed the re-calculation of
	  the residual.

2009-04-17 18:58  xavier

	* [r5264] src/scf/eigen.F90, src/scf/eigen_rmmdiis_inc.F90: Added
	  preconditioning to the rmmdiis eigensolver.

2009-04-17 23:43  xavier

	* [r5265] testsuite/finite_systems_3d/10-fullerene.01-gs.inp,
	  testsuite/finite_systems_3d/10-fullerene.test,
	  testsuite/finite_systems_3d/Makefile.am: The diis eigensolver
	  appears to be working, so I added a test for it:
	  a fullerene molecule.

2009-04-18 00:13  xavier

	* [r5266] src/basic/calc_mode.F90, src/scf/eigen_rmmdiis_inc.F90: *
	  Reenabled parallelization in k points for all modes and
	  parallelization in states for the ground state.

2009-04-18 07:19  xavier

	* [r5267] testsuite/finite_systems_3d/Makefile.am: Removed
	  whitespaces after a backslash.

2009-04-18 14:25  xavier

	* [r5268] src/scf/eigen_rmmdiis_inc.F90: * The calculation of
	  lambda in the diis solver was not correct.
	  * Reorganized the code for the first iteration of diis.

2009-04-18 15:07  xavier

	* [r5269] src/scf/eigen_rmmdiis_inc.F90: * Now the diis eigensolver
	  also preconditions the calculation of lambda.
	  * Added the restriction to value of lambda.

2009-04-18 16:26  acastro

	* [r5270] src/math/oct_gsl_min_f.c, src/opt_control/iter.F90,
	  src/opt_control/opt_control.F90,
	  src/opt_control/opt_control_global.F90: Improved the output of
	  the iteration information in QOCT runs.
	  
	  Added a double check for the computation of the gradient of the
	  QOCT
	  merit functional.

2009-04-18 16:48  xavier

	* [r5271] src/scf/eigen.F90: Updated the description for the
	  rmmdiis eigensolver.

2009-04-18 22:51  nitsche

	* [r5272] src/grid/ob_interface.F90, src/hamiltonian/ob_lead.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/ob_green.F90,
	  src/td/ob_mem.F90: * changed some static arrays to allocatables
	  * replaced some lalg_copy calls

2009-04-18 23:24  nitsche

	* [r5273] src/system/output_h_sys.F90: * extended h_sys_output_all
	  to handle k-point parallelization

2009-04-19 05:29  xavier

	* [r5274] src/grid/batch.F90, src/grid/batch_inc.F90,
	  src/grid/mesh_function_inc.F90, src/scf/eigen_rmmdiis_inc.F90:
	  Optimization:
	  * The batch object now stores a copy of the contiguous array it
	  is
	  available.
	  * Blas gemm is used by mf_dotp_batch if possible.

2009-04-19 06:03  xavier

	* [r5275] src/states/states_block_inc.F90: Now states_blockt_mul
	  initializes the batchs as contiguous if it is
	  possible.

2009-04-19 09:52  acastro

	* [r5276] src/opt_control/iter.F90,
	  src/opt_control/opt_control.F90: I learn from the buildbot that
	  xlf does not like my style of
	  quotations in the format definitions. I think this change should
	  make
	  them legal.

2009-04-19 12:04  acastro

	* [r5277] src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/lasers.F90, src/hamiltonian/lasers_inc.F90: A
	  solution for some weird compiler error (ifort 10.0 in opteron
	  machines).

2009-04-19 12:39  acastro

	* [r5278] src/opt_control/initst.F90: There was another case of
	  copying states_t variables being copied
	  through the overloaded "=", which no longer exists.

2009-04-19 17:12  xavier

	* [r5279] src/grid/mesh_function_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90: * Added more profiling regions to
	  the Xmf_dotp_batch function.
	  * Added progress bar output to the first iteration of diis.

2009-04-19 18:11  xavier

	* [r5280] src/grid/batch_inc.F90, src/scf/eigen_rmmdiis_inc.F90:
	  The hamiltonian in the rmmdiis eigensolver is now applied by
	  blocks.

2009-04-19 19:03  xavier

	* [r5281] src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90: Added
	  preconditioner_apply_batch function.

2009-04-19 20:34  acastro

	* [r5282] src/opt_control/target.F90,
	  testsuite/optimal_control/03-localtarget.test: A couple of little
	  numerical bugs that made however a big difference
	  in some QOCT results.

2009-04-19 22:09  xavier

	* [r5283] src/scf/eigen_rmmdiis_inc.F90: More operations done by
	  blocks.

2009-04-19 22:29  xavier

	* [r5284] src/scf/eigen_rmmdiis_inc.F90: More operations by blocks.

2009-04-20 07:17  xavier

	* [r5285] src/grid/mesh_function_inc.F90,
	  src/scf/eigen_rmmdiis_inc.F90: More changes to the rmmdiis
	  solver:
	  * Deallocations were missing.
	  * Some reductions are now done by blocks.

2009-04-20 09:58  xavier

	* [r5286] src/scf/eigen_rmmdiis_inc.F90: The case when the
	  diagonalization fails is now handled properly.

2009-04-20 09:58  xavier

	* [r5287] src/opt_control/opt_control.F90: Fixed the compilation
	  with xlf.

2009-04-20 10:03  xavier

	* [r5288] src/scf/eigen_rmmdiis_inc.F90: Some deallocations were
	  missing.

2009-04-20 11:55  mjv500

	* [r5289] src/grid/derivatives.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  cleaned modelMB init copy end

2009-04-20 15:35  nitsche

	* [r5290] src/ions/simul_box.F90, src/scf/ground_state.F90,
	  src/states/restart.F90, src/states/states.F90, src/td/ob_rti.F90,
	  testsuite/open_systems/01-wavepacket.01-deriv_order_1.inp,
	  testsuite/open_systems/01-wavepacket.02-deriv_order_4.inp,
	  testsuite/open_systems/01-wavepacket.test,
	  testsuite/open_systems/02-wavepacket_2d.01-full_q.inp,
	  testsuite/open_systems/02-wavepacket_2d.test,
	  testsuite/open_systems/03-extended_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/03-extended_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/03-extended_eigenstate.test,
	  testsuite/open_systems/04-propagate_eigenstate.01-square_well_1d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.02-ring_leads_2d.inp,
	  testsuite/open_systems/04-propagate_eigenstate.test,
	  testsuite/open_systems/Makefile.am: * fixed a memory leak
	  * fixed open boundary mode to run with k-point parallelization
	  * updated corresponding tests, added a full transport test

2009-04-20 15:50  nitsche

	* [r5291] src/states/states.F90: * some cleanup of my last commit

2009-04-20 17:31  mjv500

	* [r5292] src/grid/derivatives.F90: stray debug lines

2009-04-20 22:33  acastro

	* [r5293] src/grid/io_function_inc.F90, src/states/restart_inc.F90:
	  When reading a function from file, if the reading fails, the
	  array
	  that should contain the function becomes undefined since it is
	  passes
	  as intent(out). I think it should be intent(inout) so that if the
	  reading is not succesfull, the array does not change.

2009-04-20 22:34  xavier

	* [r5294] src/states/states.F90: The call to modelmb_particles_end
	  causes a segmentation fault, I don't
	  know how to fix it so I commented the line.

2009-04-20 23:04  xavier

	* [r5295] src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90:
	  Added the project_psi_batch function.

2009-04-20 23:39  acastro

	* [r5296] src/opt_control/propagation.F90: Yet another states_t
	  variable was being copied with "=" instead of
	  with states_copy, creating the usual trouble.

2009-04-21 07:52  marques

	* [r5297] libxc/testsuite/Makefile.am, src/basic/calc_mode.F90,
	  src/grid/io_function.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/hamiltonian/hamiltonian_inc.F90,
	  src/ions/simul_box.F90, src/main/Makefile.am, src/main/main.F90,
	  src/main/run.F90, src/states/mix.F90, src/states/restart.F90,
	  src/system/output_h.F90: I implemented the inversion of the
	  Kohn-Sham equations (static). It seems to work in simple cases,
	  but the iterative procedure does lack stability, and fails to
	  converge for more complicated densities...

2009-04-21 12:49  xavier

	* [r5298] src/hamiltonian/projector_inc.F90: Optimization of the
	  application of the projector in blocks.

2009-04-21 13:07  marques

	* [r5299] src/main/invert_ks.F90: The missing file.

2009-04-21 13:38  xavier

	* [r5300] src/hamiltonian/projector_inc.F90: My last commit broke
	  compliation in parallel.

2009-04-21 16:39  acastro

	* [r5301] src/hamiltonian/projector_inc.F90,
	  src/opt_control/opt_control.F90,
	  testsuite/optimal_control/04-box.08-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/Makefile.am: o Added a test for the
	  newly added conjugate gradients QOCT scheme.
	  
	  o A few lines were too long in projector_inc.F90.

2009-04-21 17:08  xavier

	* [r5302] src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/system/preconditioners_inc.F90: Now the filter preconditioner
	  acts by blocks.

2009-04-21 17:21  xavier

	* [r5303]
	  testsuite/finite_systems_3d/20-eigensolver.06-rmmdiis.inp,
	  testsuite/finite_systems_3d/20-eigensolver.test: Updated the
	  results for the diis eigensolver.

2009-04-21 18:06  mjv500

	* [r5304] src/grid/mesh.F90, src/grid/mesh_init.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90: debug
	  hypercube mesh%x generation

2009-04-21 18:17  mjv500

	* [r5305] src/states/modelmb_particles.F90, src/system/system.F90:
	  mass copying routine

2009-04-21 19:40  xavier

	* [r5306] src/basic/distributed.F90, src/basic/multicomm.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/hamiltonian.F90,
	  src/main/run.F90, src/states/states.F90,
	  src/states/states_dim.F90: The segmentation fault in gfortran
	  seemed to be a compiler problem*,
	  removing the initializations to null, that Alberto introduced the
	  other day, avoids it.
	  
	  * I am not sure if this is actually a problem or it is a side
	  effect
	  of variables being declared save.

2009-04-21 21:29  acastro

	* [r5307] testsuite/optimal_control/03-localtarget.03-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.03-tdoct.inp,
	  testsuite/optimal_control/03-localtarget.04-gs-mp.inp,
	  testsuite/optimal_control/03-localtarget.04-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.05-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/Makefile.am: Added a test for QOCT with
	  time-dependent targets.

2009-04-21 23:27  acastro

	* [r5308] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90, src/td/td_rti.F90: A number of
	  bugs/problems that prevented QOCT with interacting
	  electrons to work.

2009-04-21 23:37  dstrubbe

	* [r5309] src/sternheimer/em_resp.F90: Added reference since I
	  found the equations I was using in the literature.

2009-04-22 10:34  marques

	* [r5310] m4/fc_sizeof.m4, src/basic/distributed.F90,
	  src/basic/messages.F90, src/basic/multicomm.F90,
	  src/basic/profiling.F90, src/common-rules.make,
	  src/grid/basins.F90, src/include/global.h, src/math/fftw3.F90,
	  src/math/lalg_adv.F90, src/math/lalg_adv_lapack.F90,
	  src/math/math.F90, src/math/math_inc.F90,
	  src/math/ode_solver_inc.F90, src/math/root_solver.F90,
	  src/math/root_solver_inc.F90, src/math/solvers_inc.F90,
	  src/math/splines.F90, src/math/tdfunction.F90: I have now
	  replaced our old ALLOCATE macro by a SAFE_ALLOCATE that now uses
	  the sizeof intrinsic of fortran to check the size of the
	  variables. A little detail that everyone should remember now is
	  that one should write
	  
	  SAFE_ALLOCATE(var(1:n))
	  
	  i.e., never forget the "1:" or fortran will not be able to check
	  the ize of the array. More commits will follow shortly ;)

2009-04-22 11:03  marques

	* [r5311] src/common-rules.make, src/include/global.h: I hope this
	  solves the compilatin issues.

2009-04-22 11:05  marques

	* [r5312] src/include/global.h, src/ions/xyz_file.F90,
	  src/species/atomic.F90, src/species/logrid.F90,
	  src/species/ps.F90, src/species/ps_cpi.F90,
	  src/species/ps_cpi_file.F90, src/species/ps_fhi.F90,
	  src/species/ps_hgh.F90, src/species/ps_in_grid.F90,
	  src/species/ps_psf.F90, src/species/ps_psf_file.F90,
	  src/species/ps_upf.F90, src/species/species.F90: Some more
	  ALLOCATE -> SAFE_ALLOCATE

2009-04-22 12:14  marques

	* [r5313] src/include/global.h: There was a backslash missing,
	  preventing compilation

2009-04-22 14:10  marques

	* [r5314] src/grid/basins.F90, src/grid/batch.F90,
	  src/grid/cube_function_inc.F90, src/grid/curv_gygi.F90,
	  src/grid/curv_modine.F90, src/grid/curvilinear.F90,
	  src/grid/derivatives.F90, src/grid/derivatives_inc.F90,
	  src/grid/double_grid.F90, src/grid/double_grid_apply.F90,
	  src/grid/fourier_space_inc.F90, src/grid/grid.F90,
	  src/grid/gridhier_inc.F90, src/grid/hypercube.F90,
	  src/grid/io_function_inc.F90, src/grid/mesh_function_inc.F90,
	  src/grid/mesh_init.F90, src/grid/multigrid.F90,
	  src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90,
	  src/grid/ob_interface.F90, src/grid/scalar_mesh.F90,
	  src/grid/stencil.F90, src/grid/stencil_star.F90,
	  src/grid/stencil_variational.F90, src/grid/submesh.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/hamiltonian/hgh_projector.F90,
	  src/hamiltonian/hgh_projector_inc.F90,
	  src/hamiltonian/kb_projector.F90, src/hamiltonian/lasers.F90,
	  src/hamiltonian/lasers_inc.F90, src/hamiltonian/ob_lead.F90,
	  src/hamiltonian/projector.F90, src/hamiltonian/projector_inc.F90,
	  src/hamiltonian/rkb_projector.F90,
	  src/hamiltonian/species_pot.F90, src/include/global.h,
	  src/ions/crystal.F90, src/ions/geometry.F90,
	  src/ions/ion_dynamics.F90, src/ions/simul_box.F90,
	  src/ions/symmetries.F90, src/ions/vibrations.F90,
	  src/poisson/poisson.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90, src/poisson/poisson_fft.F90,
	  src/poisson/poisson_isf.F90, src/poisson/poisson_multigrid.F90,
	  src/poisson/solver_3D.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90, src/states/elf.F90,
	  src/states/excited_states.F90, src/states/excited_states_inc.F90,
	  src/states/ksinversion.F90, src/states/linear_response.F90,
	  src/states/linear_response_inc.F90, src/states/magnetic.F90,
	  src/states/mix.F90, src/states/mix_inc.F90,
	  src/states/modelmb_particles.F90, src/states/ob_green.F90,
	  src/states/restart.F90, src/states/smear.F90,
	  src/states/states.F90, src/states/states_block.F90,
	  src/states/states_block_inc.F90, src/states/states_calc.F90,
	  src/states/states_calc_inc.F90, src/states/states_dim.F90,
	  src/states/states_kpoints.F90, src/system/energy_inc.F90,
	  src/system/exponential.F90, src/system/exponential_split.F90,
	  src/system/linear_solver_inc.F90, src/system/output_h.F90,
	  src/system/output_h_sys.F90,
	  src/system/output_linear_response.F90,
	  src/system/output_states.F90, src/system/pert.F90,
	  src/system/pert_inc.F90, src/system/preconditioners.F90,
	  src/system/preconditioners_inc.F90, src/system/system.F90,
	  src/system/v_ks.F90, src/system/xc_KLI_inc.F90,
	  src/system/xc_OEP.F90, src/system/xc_OEP_SIC_inc.F90,
	  src/system/xc_OEP_inc.F90, src/system/xc_OEP_kernel_inc.F90,
	  src/system/xc_OEP_x_inc.F90, src/xc/axc.F90, src/xc/fxc.F90,
	  src/xc/kxc.F90, src/xc/vxc.F90: Many more ALLOCATE ->
	  SAFE_ALLOCATE

2009-04-22 15:55  marques

	* [r5315] src/opt_control/filters.F90, src/scf/eigen.F90,
	  src/scf/eigen_cg_inc.F90, src/scf/eigen_evolution_inc.F90,
	  src/scf/eigen_lobpcg_inc.F90, src/scf/eigen_mg_inc.F90,
	  src/scf/eigen_plan_inc.F90, src/scf/eigen_rmmdiis_inc.F90,
	  src/scf/lcao.F90, src/scf/lcao_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/scf/scf.F90,
	  src/scf/subspace_inc.F90, src/td/cpmd.F90, src/td/cpmd_inc.F90,
	  src/td/ob_mem.F90, src/td/ob_rti.F90, src/td/ob_src.F90,
	  src/td/pes_mask.F90, src/td/pes_rc.F90, src/td/spectrum.F90,
	  src/td/td.F90, src/td/td_calc.F90, src/td/td_rti.F90,
	  src/td/td_write.F90: And many more ALLOCATE -> SAFE_ALLOCATE

2009-04-22 16:28  mjv500

	* [r5316] src/td/spectrum.F90: bad parentheses

2009-04-22 16:30  mjv500

	* [r5317] src/states/modelmb_particles.F90, src/system/energy.F90:
	  correct copy of pointers and spacing format

2009-04-23 03:12  acastro

	* [r5318] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/opt_control.F90, src/opt_control/propagation.F90,
	  src/opt_control/target.F90,
	  testsuite/optimal_control/07-qoct+tddft.01-ground_state.inp,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test,
	  testsuite/optimal_control/Makefile.am: Enabled the option of
	  doing QOCT with interacting electrons. Added a
	  test for a two-electron 2D case. I had to correct a few bugs here
	  and
	  there, and add the xc kernel to the definition of the QOCT
	  exchange-like operator.

2009-04-23 10:15  xavier

	* [r5319] src/include/global.h: Fixes a problem with compilers
	  where sizeof does not work on
	  non-allocated arrays.

2009-04-23 15:29  marques

	* [r5320] src/basic/messages.F90, src/basic/mpi_lib_inc.F90,
	  src/basic/multicomm.F90, src/basic/profiling.F90,
	  src/grid/mesh_init.F90, src/grid/par_vec.F90,
	  src/grid/par_vec_inc.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/hamiltonian.F90, src/include/global.h,
	  src/main/casida.F90, src/main/casida_inc.F90, src/main/gcm.F90,
	  src/main/geom_opt.F90, src/main/invert_ks.F90,
	  src/main/one_shot.F90, src/main/phonons_fd.F90,
	  src/main/static_pol.F90, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/opt_control/initst.F90,
	  src/opt_control/iter.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90,
	  src/opt_control/propagation.F90, src/opt_control/target.F90,
	  src/poisson/solver_1D.F90, src/poisson/solver_2D.F90,
	  src/states/modelmb_particles.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90, src/sternheimer/phonons_lr.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90, src/sternheimer/vdW.F90,
	  src/utils/broad.F90, src/utils/cross_section.F90,
	  src/utils/dielectric_function.F90,
	  src/utils/oscillator_strength.F90, src/utils/phonon_spectrum.F90:
	  Memory profiling is now much nicer. It can give you a summary of
	  the memory that was allocated/dellocated, and the largest
	  variables ever allocated by the code. Xavier, can you please now
	  try to solve the issues with xlf?

2009-04-23 15:41  xavier

	* [r5321] src/basic/profiling.F90: Fixed compilation issue in
	  Miguel's commit.

2009-04-23 15:59  nitsche

	* [r5322] src/grid/grid.F90, src/hamiltonian/ob_lead.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/td/ob_mem.F90,
	  src/td/ob_rti.F90: * Fixed memory leak in open boundaries.
	  * Fixed output in lippmann-schwinger cycle (in parallel).
	  * Fixed the issue of not be able to continue the calculation of
	  the memory coefficients. Now it uses less memory and is probably
	  faster. Saved coefficients with previous versions will not work
	  anymore.
	  * Changed some DEALLOCATE to SAFE_DEALLOCATE
	  * The td-run of the open boundaries now decides on its own what
	  solver it uses for the propagation. With a time-dependent
	  magnetic field in the central region the propagation switches to
	  Bi-CG as the QRM_sym is not suitable in this case (not yet the
	  best option, but the only one the does not suffer from
	  breakdowns).

2009-04-23 16:02  nitsche

	* [r5323] testsuite/open_systems/04-propagate_eigenstate.test: *
	  some outputs changed slightly due to the new calculation of the
	  memory coefficients

2009-04-23 16:10  xavier

	* [r5324] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/epot.F90, src/hamiltonian/projector.F90,
	  src/hamiltonian/projector_inc.F90: Removed the option of
	  performing asynchronously the reduction of the
	  pseudopotentials. This was much slower that the current scheme
	  and
	  consumed a considerable amount of memory.

2009-04-23 16:20  xavier

	* [r5325] src/basic/profiling.F90: More compilation issues due to
	  privacy of some types.

2009-04-23 16:53  xavier

	* [r5326] src/basic/profiling.F90: Converted output of memory
	  profiling to megabytes.

2009-04-23 18:23  acastro

	* [r5327] src/math/sparskit_inc.F90: Attempting to compile with
	  sparskit failed because of some ALLOCATEs.

2009-04-23 19:19  acastro

	* [r5328] src/states/modelmb_particles.F90, src/states/states.F90:
	  You won't believe this, but the modelmb segfault was back, at
	  least I
	  get it in the finite_systems_1d/09-morse.test and in the
	  optimal_control/01-asym_doublewell.test.
	  
	  I added a modelMB_particles_null routine, which is be called from
	  states_null. That way one is sure that the pointers point to
	  null, and
	  not to god knows what. This seems to solve the bug. Still,
	  states_null
	  is not perfect, since other derived data types within the
	  states_t
	  structure don't have the corresponding *_null routines.
	  
	  I don't know if we should add *_null routines everywhere for all
	  data
	  types, and make sure that they are called for every variable.
	  This
	  would be the only way to make sure that we can kill all pointers
	  safely (no matter if our deallocate routine is now called
	  "SAFE").
	  
	  The "=> NULL()" feature, if it works properly, would solve the
	  issue
	  more elegantly. And even better, I think, would be to use
	  "allocatable" arrays for derived data types, but you all voted
	  against
	  it.

2009-04-23 21:47  nitsche

	* [r5329] src/scf/ob_lippmann_schwinger.F90: * fix of the issue
	  tobias found within the lippmann-schwinger gs-run

2009-04-24 07:16  nitsche

	* [r5330] src/scf/ground_state.F90,
	  src/scf/ob_lippmann_schwinger.F90,
	  testsuite/open_systems/04-propagate_eigenstate.test: * fixed a
	  bug in initializing the wavefunctions for the lippmann-schwinger
	  calculation - this fixes the convergence and therefore the
	  warning that the scf is not converged (during lippmann-schwinger
	  cycle)
	  * fixed some more np <--> np_part, due to that the results
	  changed a bit and I adapted one test

2009-04-24 08:40  acastro

	* [r5331] src/hamiltonian/hamiltonian_inc.F90,
	  src/scf/eigen_cg_inc.F90, src/system/preconditioners_inc.F90:
	  Fixed a bug caused by use of non-initialized variables, related
	  to an
	  "intent(out)".

2009-04-24 12:15  marques

	* [r5332] perl/Makefile.am, perl/oct-analyze_projections,
	  perl/oct-analyze_projections.pl, perl/oct-check-deallocs,
	  perl/oct-vdW_c6, perl/oct-vdW_c6.pl: *) Added a little perl
	  script to check thinks that are nor deallocated after running
	  with full memory profiling
	  *) Now perl scripts use /usr/bin/env perl to run. This should be
	  quite portable.

2009-04-24 12:43  marques

	* [r5333] perl/oct-check-deallocs, perl/oct-check_deallocs: Sorry,
	  wrong filename

2009-04-24 13:43  marques

	* [r5334] src/basic/command_line.F90, src/basic/ialist.F90,
	  src/basic/iihash.F90, src/ions/simul_box.F90,
	  src/main/casida.F90, src/math/tdfunction.F90,
	  src/states/states.F90, src/states/states_dim.F90,
	  src/td/ob_src.F90, src/utils/oscillator_strength.F90: Some small
	  leftovers from the ALLOCATE stuff

2009-04-24 14:43  xavier

	* [r5335] src/ions/simul_box.F90: Xlf has problems with one
	  allocation, so it is done directly.

2009-04-24 15:45  acastro

	* [r5336] src/math/lalg_adv.F90, src/system/exponential.F90,
	  testsuite/finite_systems_1d/09-morse.test,
	  testsuite/finite_systems_2d/05-spin_precession.test,
	  testsuite/finite_systems_2d/06-tdmagnetic.test,
	  testsuite/optimal_control/02-sym_doublewell.test,
	  testsuite/optimal_control/03-localtarget.05-oct-mp.inp,
	  testsuite/optimal_control/03-localtarget.test,
	  testsuite/optimal_control/04-box.02-oct_long.inp,
	  testsuite/optimal_control/04-box.03-oct_long.inp,
	  testsuite/optimal_control/04-box.04-oct_long.inp,
	  testsuite/optimal_control/04-box.05-oct_long.inp,
	  testsuite/optimal_control/04-box.06-oct_long.inp,
	  testsuite/optimal_control/04-box.07-oct_long.inp,
	  testsuite/optimal_control/04-box.08-oct_long.inp,
	  testsuite/optimal_control/04-box.test,
	  testsuite/optimal_control/05-adw.02-filter_fixed.inp,
	  testsuite/optimal_control/05-adw.03-filter_indirect.inp,
	  testsuite/optimal_control/06-zbr98.test,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp: There was a
	  bug in the the computation of the zlalg_exp; the
	  computation of the exponential of a matrix for complex hermitian
	  matrices was wrong. Because of this, the lanczos method was not
	  done
	  correctly. This has happened since we got rid of the expokit
	  library
	  (around seven months ago). Fortunately, the results were not too
	  compromised because the final computation was done by calling
	  zlalg_exp with the non-hermitian flag. However, the stop
	  criterion was
	  not computed correctly, and as a result we could have too many or
	  too
	  few iterations.
	  
	  The results of some tests changed a little bit (very small
	  changes
	  usually), and I changed slightly some of them.

2009-04-24 16:28  acastro

	* [r5337] testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test: Changed a little
	  this test, which seemed to give slightly different
	  numbers with different compilers.

2009-04-26 07:40  nitsche

	* [r5338] src/states/states.F90: * initialized pointers in
	  states.F90 related to open boundaries to null, that fixes
	  (hopefully) the failing of deallocation in some cases of ob_green
	  in td-mode where it is not used

2009-04-26 08:24  nitsche

	* [r5339] src/states/states.F90: * next try: removed the null
	  initialization, added nullify of the open boundary pointers to
	  states_null

2009-04-26 08:31  acastro

	* [r5340] src/hamiltonian/hamiltonian.F90: One test (in the OCT
	  section) was producing rather different results
	  depending on the machine, and one of the reasons seems to be the
	  lack
	  of initialization to zero of this variable.

2009-04-26 17:55  xavier

	* [r5341] configure.ac: Changed version to 3.2.0pre1.

2009-04-26 19:37  xavier

	* [r5342] src/basic/Makefile.am: Some dependencies were missing.

2009-04-26 19:53  xavier

	* [r5343] src/scf/lcao.F90, src/scf/lcao_inc.F90: Included an
	  alternative implementation of LCAO.

2009-04-27 08:14  xavier

	* [r5344] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/hamiltonian/species_pot.F90, src/scf/lcao.F90,
	  src/scf/lcao_inc.F90, src/species/species.F90: Part of the atomic
	  orbitals are only calculated in a spherical grid
	  around the atom.

2009-04-27 08:43  xavier

	* [r5345] src/grid/submesh_inc.F90,
	  src/hamiltonian/species_pot.F90, src/scf/lcao_inc.F90,
	  src/species/species.F90: All orbitals are now calculated in the
	  submesh (integrals are still
	  done in the full mesh, though).

2009-04-27 09:30  micael

	* [r5346] configure.ac, m4/etsf_io.m4, src/common-rules.make,
	  src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/system/Makefile.am, src/system/output_etsf.F90,
	  src/system/output_h_sys.F90: Implemented basic support for the
	  ETSF file format. This is done using the ETSF_IO library. Note
	  that this is still experimental and limited to finite systems.
	  
	  As a bonus, we can now use v_sim to plot some of the output
	  produced by octopus.

2009-04-27 13:44  xavier

	* [r5347] src/scf/lcao_inc.F90: Now the submeshes for the
	  alternative LCAO are initialized once for
	  all orbitals.

2009-04-27 14:08  acastro

	* [r5348] src/opt_control/target.F90: Yet another case in which a
	  states_t variable was copied with the "="
	  sign, instead of with states_copy.

2009-04-27 15:13  xavier

	* [r5349] src/scf/lcao_inc.F90: Atomic orbitals are now also
	  precalculated.

2009-04-27 15:54  xavier

	* [r5350] src/grid/submesh.F90, src/grid/submesh_inc.F90,
	  src/scf/lcao_inc.F90: The matrix elements for LCAO are calculated
	  in the spherical grid.

2009-04-27 17:12  xavier

	* [r5351] src/scf/lcao_inc.F90: Matrix elements of orbitals that do
	  not overlap are not calculated.

2009-04-27 18:31  acastro

	* [r5352]
	  testsuite/optimal_control/07-qoct+tddft.01-ground_state.inp,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp: This test was
	  producing different results on different machines due to
	  its bad design (it used a state of a degenerate set, and this
	  could be
	  different on each run).

2009-04-27 18:36  acastro

	* [r5353] testsuite/optimal_control/07-qoct+tddft.test: Sorry, I
	  forgot to change the value of the test check in the previous
	  commit.

2009-04-28 13:17  acastro

	* [r5354] src/math/lalg_adv.F90, src/opt_control/check_input.F90,
	  src/opt_control/opt_control.F90, src/system/exponential.F90: Now
	  the time propagation with an inhomogeneous Schrodinger equation
	  can be also done using the exponential midpoint rule together
	  with the
	  Lanczos expansion. Before, one could only use the Crank-Nicholson
	  method.

2009-04-28 13:28  xavier

	* [r5355] src/sternheimer/em_resp.F90: Now when the frequency is
	  zero the sternheimer equation only for one sign
	  is calculated.

2009-04-28 16:26  xavier

	* [r5356] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: I am reimplementing the
	  2n+1 theorem expression in a more general and
	  cleaner way. This is the first step.

2009-04-30 00:57  acastro

	* [r5357] src/grid/mesh.F90: The open system tests (at least
	  open_systems/01-wavepacket.test and
	  open_systems/03-extended_eigenstate.test) were failing in my
	  machine
	  because of this little error (that affects only runs with reduced
	  dimensionality)

2009-05-01 19:23  mjv500

	* [r5358] src/grid/io_function_inc.F90,
	  src/grid/mesh_function_inc.F90, src/ions/geometry.F90,
	  src/ions/xyz_file.F90, src/states/Makefile.am,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: MB state sym checking and
	  antisymmetrization

2009-05-05 19:12  mjv500

	* [r5359] src/grid/mesh.F90, src/math/Makefile.am,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90: antisymmetrization starts
	  for MB wf

2009-05-05 19:45  mjv500

	* [r5360] src/math/permutations.F90: forgot permutations.F90

2009-05-05 19:55  helbig

	* [r5361] src/main/invert_ks.F90, src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: some ks inversion plus bug
	  fixes from MJV

2009-05-06 13:19  nitsche

	* [r5362] src/ions/simul_box.F90: * fixed a bug in
	  simul_box_init_from_file when using more than one node with mpi
	  (changed read to iopar_read)

2009-05-06 16:54  mjv500

	* [r5363] src/grid/hypercube.F90, src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/main/invert_ks.F90,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90:
	  symmetrize mb states to s2 eigenfunctions, with Young tableaux

2009-05-06 17:30  mjv500

	* [r5364] src/grid/Makefile.am, src/grid/mesh_function.F90,
	  src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: dependencies for modelmb_1part
	  datastructure

2009-05-06 17:31  mjv500

	* [r5365] src/grid/modelmb_1part.F90: creation of modelmb_1part
	  datastructure

2009-05-06 17:35  helbig

	* [r5366] src/states/modelmb_exchange_syms.F90: undeclared variable
	  now declared

2009-05-07 09:42  nitsche

	* [r5367] src/td/ob_mem.F90: * bugfix: a non-found file should not
	  be closed (ob_mem.read_coeffs)

2009-05-07 10:59  xavier

	* [r5368] src/scf/eigen_rmmdiis_inc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: Some deallocations missing.

2009-05-07 16:40  mjv500

	* [r5369] src/math/Makefile.am, src/math/young.F90,
	  src/states/modelmb_exchange_syms.F90: added Young diagrams

2009-05-07 16:44  mjv500

	* [r5370] src/states/modelmb_exchange_syms.F90: limit output volume
	  for states projected out

2009-05-07 16:59  helbig

	* [r5371] src/states/modelmb_exchange_syms.F90: bug fixes in
	  modelmb

2009-05-08 09:18  acastro

	* [r5372] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90,
	  src/opt_control/check_input.F90, src/opt_control/target.F90,
	  src/system/exponential.F90, src/td/td_rti.F90,
	  testsuite/optimal_control/07-qoct+tddft.02-oct.inp,
	  testsuite/optimal_control/07-qoct+tddft.test: OCT with
	  interacting electrons was not working for more than two
	  electrons (only one orbital). Now it is, although it is rather
	  slow. In order to make it work, I had to change the way in which
	  the
	  propagation is performed (I introduced a new propagation scheme).

2009-05-08 23:30  xavier

	* [r5373] src/main/invert_ks.F90: Flush is not always available.

2009-05-09 13:08  xavier

	* [r5374] src/grid/submesh_inc.F90, src/scf/lcao_inc.F90: The
	  alternative LCAO implementation now works with domain
	  parallelization.

2009-05-09 22:20  xavier

	* [r5375] src/system/energy_inc.F90: An allgathering of eigenvalues
	  is missing, I will put a warning for
	  the moment.

2009-05-09 22:35  xavier

	* [r5376] src/scf/lcao_inc.F90: The alternative LCAO implementation
	  is now parallel in atoms (states).

2009-05-12 16:26  xavier

	* [r5377] src/scf/eigen_rmmdiis_inc.F90: The first iteration of
	  diis is also done by blocks.

2009-05-13 09:02  marques

	* [r5378] src/hamiltonian/scf_tol.F90,
	  src/system/linear_solver.F90: Added two new ways of changinf the
	  convergence during the lr scf process, linearly and
	  exponentially. For the h2o example, it turns out that the
	  exponential is the fastest, followed by the adaptative, constant,
	  and the linear.

2009-05-13 10:33  marques

	* [r5379] src/hamiltonian/scf_tol.F90,
	  src/sternheimer/sternheimer.F90,
	  src/sternheimer/sternheimer_inc.F90,
	  src/system/linear_solver.F90, src/system/linear_solver_inc.F90,
	  src/system/xc_OEP_inc.F90: Some cleaning of the way the scf_tol
	  was used

2009-05-13 10:54  marques

	* [r5380] libxc/src/gga_c_pbe.c, libxc/src/gga_x_pbe.c: Added a
	  couple of reparametrizations of the PBE by the group of Klaus
	  Capelle. Note that all the other combinations present in the
	  paper can be obatined by combining the already existing exchanges
	  and correlations of PBE and PBE_SOL. For example: GCGX =
	  x_PBE_SOL + c_PBE

2009-05-13 11:13  marques

	* [r5381] perl/Makefile.am: perl scripts were not included in the
	  distribution, which made make fail

2009-05-13 11:25  nitsche

	* [r5382] src/grid/ob_interface.F90, src/math/solvers_inc.F90,
	  src/scf/ob_lippmann_schwinger.F90, src/states/ob_green.F90,
	  src/states/states.F90, src/system/output_h_sys.F90,
	  src/td/ob_rti.F90, src/td/td_rti.F90,
	  testsuite/open_systems/04-propagate_eigenstate.test: * replaced
	  some lalg routines in the qmr-solver, surface green function and
	  lippmann-schwinger gs (for speedups)
	  * a lot of code cleaning for open boundaries
	  * changed convergence test of the surface green function
	  * Now the symmetric qmr-solver is always used within the
	  propagation of open boundary scheme. In the cases where the
	  operator is not complex symmetric (vector potential present) the
	  operator is symmetrized: A.x=b --> (A^T).A.x=(A^T).b
	  * Due to the changes some values in the test-suite changed as
	  well
	  * some preparations and changes for a magnetic field (or vector
	  potential) present in the ground state (not working yet)

2009-05-13 13:19  acastro

	* [r5383] src/hamiltonian/lasers_inc.F90,
	  src/opt_control/propagation.F90, src/system/output_etsf.F90: o
	  Removed some unnecessary use of pointers in the lasers module,
	  which
	  was causing internal compiler errors when compiling with intel. I
	  think the code is "safer" this way.
	  
	  o There was one parenthesis too many in a couple of places in
	  output_etsf.F90

2009-05-13 18:08  xavier

	* [r5384] src/sternheimer/em_resp_calc_inc.F90: Optimized a bit the
	  calculation of the hyperpolarizability.

2009-05-13 18:38  xavier

	* [r5385] src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90: More matrix elements in the
	  calculation of beta are precomputed.

2009-05-13 21:50  xavier

	* [r5386] src/grid/derivatives.F90: For non-curvilinear coordinates
	  Derivative weights are now generated using the stencil.

2009-05-13 22:38  xavier

	* [r5387] src/grid/derivatives_inc.F90, src/grid/mesh.F90,
	  src/grid/nl_operator.F90, src/ions/simul_box.F90: For zero bc now
	  the nl_operator uses a single boundary point.

2009-05-14 07:40  xavier

	* [r5388] src/grid/derivatives_inc.F90, src/grid/nl_operator.F90:
	  Using one point for the boundaries actually increases the number
	  of
	  in-grid stencils, it is possible to reduce it by playing a bit
	  with
	  boundary points in the nl_operator.

2009-05-14 10:02  helbig

	* [r5389] src/main/invert_ks.F90, src/states/restart.F90: td
	  density matrix output

2009-05-14 12:33  marques

	* [r5390] src/basic/messages.F90, src/basic/varia.c: Now the status
	  bar is printed when not in interactive.

2009-05-14 17:11  xavier

	* [r5391] src/main/invert_ks.F90, src/scf/lcao_inc.F90: Fixes some
	  things that xlf does not like.

2009-05-14 17:38  xavier

	* [r5392] src/scf/scf.F90, src/states/states.F90,
	  src/sternheimer/em_resp_calc_inc.F90,
	  src/system/output_states.F90, src/system/v_ks.F90: * Now the
	  current is only allocated for CDFT (i.e. never).
	  * Renamed st%j to st%current.

2009-05-14 22:33  mjv500

	* [r5393] src/grid/modelmb_1part.F90, src/ions/simul_box.F90,
	  src/math/young.F90, src/states/density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: restructured modelmb and fixed
	  MAX_DIM bug in simul_box

2009-05-14 22:36  mjv500

	* [r5394] src/states/density_matrix.F90: intent was incorrect

2009-05-14 22:39  mjv500

	* [r5395] src/states/density_matrix.F90: line lengths corrected

2009-05-15 09:26  xavier

	* [r5396] src/beak/operate_ri_vec.c: doperate_ri_vec can be
	  simplified a bit.

2009-05-15 09:27  xavier

	* [r5397] src/grid/batch.F90, src/grid/batch_inc.F90,
	  src/scf/lcao_inc.F90: * Now a batch can directly allocate and
	  deallocate components.
	  * This is used for the alternative LCAO.

2009-05-15 13:36  xavier

	* [r5398] src/grid/nl_operator.F90, src/grid/nl_operator_inc.F90:
	  Improved nl_operate_batch.

2009-05-15 13:40  xavier

	* [r5399] src/states/density_matrix.F90: * An intent declaration
	  was not correct.
	  * Removed some unnecessary "implicit none".

2009-05-15 14:26  xavier

	* [r5400] src/scf/scf.F90: The calculation of the forces can be
	  disabled with the
	  SCFCalculateForces variables.

2009-05-15 14:36  acastro

	* [r5401] src/opt_control/propagation.F90: Solved a couple of bugs
	  that affected the QOCT runs with interacting
	  electrons.

2009-05-16 10:31  xavier

	* [r5402] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90,
	  src/td/td_rti.F90: Removed hamiltonian_apply_all and
	  exponential_apply_all, these are
	  just particular cases of hamiltonian_apply_batch and
	  exponential_apply_batch.

2009-05-16 15:00  xavier

	* [r5403] src/beak/operate_ri.c: Improvements of the nl_operator.

2009-05-16 16:55  xavier

	* [r5404] src/system/energy_inc.F90: Removed a warning message. It
	  appears at every time propagation step.

2009-05-16 18:11  xavier

	* [r5405] src/scf/ground_state.F90, src/scf/lcao_inc.F90: Some
	  changes in the output of the LCAO.

2009-05-16 18:17  xavier

	* [r5406] src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90,
	  src/td/td_rti.F90: Reverted changeset 5402.

2009-05-16 18:53  xavier

	* [r5407] src/hamiltonian/hamiltonian_inc.F90: Now
	  hamiltonian_apply_all uses hamiltonian_apply_batch.

2009-05-16 23:41  xavier

	* [r5408] src/system/exponential.F90: Optimization of
	  taylor_series_batch.

2009-05-17 14:16  xavier

	* [r5409] src/states/states.F90, src/system/energy.F90,
	  src/system/energy_inc.F90, src/system/v_ks.F90, src/td/td.F90:
	  Several small changes.

2009-05-17 16:45  xavier

	* [r5410] testsuite/real_time/02-aetrs.04-kick.inp,
	  testsuite/real_time/02-aetrs.test,
	  testsuite/real_time/Makefile.am: Added a test for propagation
	  with a kick, we didn't have any.

2009-05-17 17:14  mjv500

	* [r5411] src/states/density_matrix.F90: stray conflict in solved

2009-05-17 18:13  xavier

	* [r5412] src/td/pes.F90, src/td/td.F90, src/td/td_init.F90: * Some
	  cleaning of the TD part.
	  
	  * Removed the references to the DISABLE_PES macro.
	  
	  * Removed the ModifyOccupations variable, it was not documented
	  and as
	  far I know it was never used.

2009-05-17 19:18  mjv500

	* [r5413] src/states/Makefile.am, src/states/density_matrix.F90,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  modelmb density calculation + clean naming

2009-05-17 21:20  xavier

	* [r5414] src/basic/profiling.F90, src/hamiltonian/hamiltonian.F90,
	  src/hamiltonian/hamiltonian_inc.F90, src/system/exponential.F90:
	  * The hamiltonian now calls axpy directly (to avoid a performance
	  problem with XLF).
	  * Moved some profiling objects from profiling_m to hamiltonian_m.
	  * Fixed the operation count for taylor_series_batch.

2009-05-17 22:44  xavier

	* [r5415] src/poisson/poisson.F90: Added variable
	  ParallelizationPoissonAllNodes that controls the nodes
	  used for the Poisson solver. By default all nodes are used, and I
	  think this causes problems with more than 500 processors.

2009-05-18 07:43  xavier

	* [r5416] src/td/td_write.F90: Included profiling regions for
	  functions in td_write.

2009-05-18 08:25  marques

	* [r5417] ChangeLog, libxc/ChangeLog, libxc/src/libxc_master.F90,
	  libxc/src/xc_f.c, src/basic/profiling.F90,
	  src/grid/mesh_function_inc.F90, src/math/loct_math.F90,
	  src/math/tdfunction.F90, src/opt_control/opt_control.F90,
	  src/opt_control/parameters.F90,
	  src/opt_control/parameters_trans.F90, src/scf/lcao_inc.F90,
	  src/system/output_h_sys.F90, src/td/spectrum.F90,
	  src/utils/oscillator_strength.F90, src/xc/functionals.F90,
	  src/xc/vxc.F90: Changes necessary to compile octopus in single
	  precision more. Alberto,
	  I guess I made a disaster in your opt-control code (that now will
	  not
	  wortk in single precision). The problem are the minimizing
	  routines that
	  do not have interfaces in single precision more. One should add
	  it...

2009-05-18 09:15  marques

	* [r5418] src/grid/grid.F90, src/grid/nl_operator.F90: We can now
	  turn off the tuning of the nl_operator. This saves a lot of
	  time when running 4d models with 1 orbital

2009-05-18 10:39  sakko

	* [r5419] src/grid/derivatives_inc.F90, src/grid/mesh_init.F90,
	  src/ions/simul_box.F90, src/poisson/poisson_cg.F90: Bug fixes and
	  improvements related to multiresolution method. Now the Poisson
	  solver seems to work with it.

2009-05-18 11:16  xavier

	* [r5420] src/poisson/poisson.F90, src/poisson/poisson_isf.F90,
	  src/poisson/solver_3D.F90: The ISF poisson solver is not
	  initialized for all nodes unless it is
	  required.

2009-05-18 11:17  micael

	* [r5421] m4/etsf_io.m4, src/system/output_etsf.F90: *) Corrected
	  the ETSF_IO configure test.
	  *) Removed a couple of debug statements.

2009-05-18 11:24  xavier

	* [r5422] src/math/loct_math.F90: Fixed compilation with g95.

2009-05-18 11:56  micael

	* [r5423] src/system/output_etsf.F90: Some calls to the ETSF_IO
	  error handler were missing.

2009-05-18 12:22  micael

	* [r5424] src/system/output_etsf.F90: *) Files in ETSF format now
	  include information about the octopus version.

2009-05-18 13:22  xavier

	* [r5425] m4/fc_sizeof.m4: Modified the test for the sizeof
	  intrinsic so it fails for the sun
	  compiler (as it should).
	  
	  This should fix the compilation problem with the sun compiler.

2009-05-18 14:36  xavier

	* [r5426] src/basic/multicomm.F90: Added a "wildcard" value to the
	  ParallelizationGroupRanks block.

2009-05-18 15:27  marques

	* [r5427] src/states/states.F90, src/system/Makefile.am,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  Started the painful move of the output of the matrix elements to
	  its own
	  module. Note that this is scattered all around... more to come ;)

2009-05-18 15:58  marques

	* [r5428] src/main/gcm.F90, src/main/unocc.F90,
	  src/opt_control/target.F90, src/scf/scf.F90,
	  src/states/states.F90, src/states/states_calc.F90,
	  src/states/states_calc_inc.F90, src/system/output_me.F90,
	  src/system/output_me_inc.F90, src/td/td_write.F90: *) forgot 2
	  files in my previous commit
	  *) Got rid of st%momentum. It makes no sense to calculate this
	  everywhere, so please calculate it when necessary. There is an
	  issue
	  with write_degeneracy_matrix, someone that knows what it is about
	  can
	  fix it? For now it will give probably nonsense, but I do not
	  understand
	  what this is for. The easy solution is to calculate the momentum
	  on the
	  spot.

2009-05-18 16:00  marques

	* [r5429] src/system/output_h_sys.F90: Condition was wrong.

2009-05-18 16:39  xavier

	* [r5430] src/scf/lcao_inc.F90: Improvement of the alternative
	  lcao.

2009-05-18 17:18  mjv500

	* [r5431] src/grid/derivatives.F90, src/grid/modelmb_1part.F90,
	  src/math/young.F90, src/states/Makefile.am,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/states/states.F90,
	  src/system/output_h_sys.F90, src/system/output_states.F90:
	  modelmb wf output

2009-05-18 17:18  mjv500

	* [r5432] src/states/modelmb_wf.F90: modelmb wf source

2009-05-18 18:29  xavier

	* [r5433] src/grid/mesh_function.F90,
	  src/grid/mesh_function_inc.F90, src/states/Makefile.am,
	  src/states/modelmb_density.F90,
	  src/states/modelmb_density_inc.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_density_matrix_inc.F90,
	  src/states/modelmb_exchange_syms.F90: Moved the calculation of
	  the few body density and density matrix to
	  the modules where they belong. We should not have physics inside
	  mesh.

2009-05-18 18:36  xavier

	* [r5434] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90: Simplified the names of
	  some members, since they belong to a structure
	  they were redundant.

2009-05-18 20:49  xavier

	* [r5435] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90: * More variables renamed.
	  * Some code formatting.

2009-05-18 21:18  xavier

	* [r5436] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/states/Makefile.am, src/states/modelmb_wf.F90,
	  src/system/output_states.F90: The function modelmb_wf_write is
	  now X(io_function_out_text).
	  
	  PS: Please do not put anything outside a module.

2009-05-18 21:53  xavier

	* [r5437] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90: Fixed compilation in
	  parallel.

2009-05-18 22:12  xavier

	* [r5438] src/grid/io_function_inc.F90: A small fix in
	  io_function_out_text.

2009-05-18 22:59  mjv500

	* [r5439] src/states/modelmb_density.F90,
	  src/states/modelmb_particles.F90: added particles_of_type to
	  modelmb

2009-05-19 08:30  micael

	* [r5440] src/common-rules.make: FCFLAGS_ETSF_IO is now passed on
	  to the compiler.

2009-05-19 08:32  marques

	* [r5441] src/scf/scf.F90, src/system/output_h_sys.F90,
	  src/system/output_me.F90: Now the angular momentum is also
	  treated as a matrix element

2009-05-19 09:00  marques

	* [r5442] src/main/Makefile.am, src/main/unocc.F90,
	  src/main/unocc_inc.F90, src/system/output_h_sys.F90,
	  src/system/output_me.F90, src/system/output_me_inc.F90,
	  src/system/output_states.F90: Now also the one body and the two
	  body matrix elements are in the
	  output_me module. Note that this module is a mess, and could be
	  greatly
	  expanded and enhanced. Now I just gathered the routines that were
	  scattered around the code. The routines, BTW, are very low
	  quality and
	  will likely fail in almost every circunstance expect the standard
	  serial
	  atomic calculations in 3d...

2009-05-19 09:01  xavier

	* [r5443] src/states/restart.F90: Now writing restart files can be
	  disabled by using:
	  
	  RestartFileFormat = restart_none

2009-05-19 09:19  acastro

	* [r5444] src/system/output_etsf.F90: Some changes needed to
	  compile in single precision. The ETSF library
	  uses double precision data type (question: always? can one
	  compile the
	  library in single precision mode? or are there single precision
	  version of the routines?), and so one has to be a little careful
	  when
	  calling the library.

2009-05-19 09:29  xavier

	* [r5445] src/states/modelmb_particles.F90: Fxies compilation with
	  g95.

2009-05-19 09:30  xavier

	* [r5446] src/system/output_me.F90: Fixes compilation in parallel.

2009-05-19 09:40  mjv500

	* [r5447] src/include/global.h, src/states/modelmb_particles.F90: 1
	  more amp in SAFE_ALLOC and cleaner names in modelmb_part

2009-05-19 09:57  marques

	* [r5448] src/grid/mesh.F90, src/hamiltonian/hamiltonian.F90: *)
	  Number of digits in the output of the number of mesh points had
	  to be
	  increase ;) Yes, I run something with more than 100 milion mesh
	  points...
	  *) Vhartree and vxc is only allocated when not running in
	  independent
	  particles.

2009-05-19 10:00  sakko

	* [r5449] src/td/td.F90: bug fix, previously ions were not kicked
	  at all in kick_density mode (since KICK_DENSITY_MODE = 0)

2009-05-19 10:22  acastro

	* [r5450] src/opt_control/opt_control.F90,
	  testsuite/optimal_control/02-sym_doublewell.test: Fixed some
	  compilation issues in single precision.

2009-05-19 10:34  xavier

	* [r5451] src/grid/nl_operator.F90: Improved the documentation for
	  OperateDouble and OperateComplex.

2009-05-19 13:08  xavier

	* [r5452] src/grid/io_function_inc.F90, src/states/restart.F90:
	  Added profiling regions to the restart functions.

2009-05-19 16:00  marques

	* [r5453] src/grid/mesh.F90: Fixed a FIXME in the output

2009-05-19 16:23  acastro

	* [r5454] src/opt_control/opt_control.F90: Several bugs (introduced
	  when I attempted to make the OCT stuff work
	  in single precision, which is not yet working always).

2009-05-19 21:01  acastro

	* [r5455] src/opt_control/opt_control.F90: More fixes to make the
	  code compile in single precision mode.

2009-05-19 21:44  xavier

	* [r5456] src/grid/par_vec.F90, src/grid/par_vec_inc.F90,
	  src/system/Makefile.am: Added the X(vec_selective_gather)
	  function, it collects a number of
	  points of a distributed vector.

2009-05-19 22:29  xavier

	* [r5457] src/grid/par_vec.F90, src/grid/par_vec_inc.F90: Added the
	  X(vec_selective_scatter) function.

2009-05-20 12:58  xavier

	* [r5458] src/basic/mpi.F90, src/grid/submesh.F90: When running
	  parallel in domains, a submesh contains a communicator
	  with all the processes that have points in that submesh.

2009-05-20 13:31  xavier

	* [r5459] src/hamiltonian/projector_inc.F90: Now the reduce buffer
	  in project_psi_batch includes the states.

2009-05-20 14:17  xavier

	* [r5460] src/hamiltonian/projector_inc.F90: The reduction in
	  project_psi_batch can also be done by projector
	  (currently it has to be enabled in the code).

2009-05-20 14:36  mjv500

	* [r5461] src/states/modelmb_exchange_syms.F90: cleaned exchangesym
	  routine

2009-05-20 18:10  micael

	* [r5462] src/system/output_etsf.F90: Now the correct ETSF_IO
	  pointer is used to store the wave-functions.

2009-05-20 19:24  xavier

	* [r5463] src/hamiltonian/projector_inc.F90: The reduction in the
	  project_psi_batch function has to be performed
	  after all calculations.

2009-05-20 21:09  xavier

	* [r5464] src/basic/profiling.F90, src/states/restart.F90,
	  src/system/v_ks.F90, src/xc/vxc.F90: Some cleaning.

2009-05-21 01:03  dstrubbe

	* [r5465] src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90, src/sternheimer/kdotp_calc.F90,
	  src/system/pert_inc.F90: Converted k.p perturbation from d/dk to
	  -i d/dk, so that it is Hermitian. This makes a few formulae
	  simpler, but is also necessary for making a real version of k.p
	  so that real gs wfns give real k.p wfns.

2009-05-21 09:02  mjv500

	* [r5466] src/math/young.F90, src/states/modelmb_exchange_syms.F90,
	  src/states/modelmb_particles.F90, src/system/output_h_sys.F90,
	  src/system/output_states.F90: improved young projection output

2009-05-21 17:26  xavier

	* [r5467] configure.ac, m4/arch.m4, m4/sse.m4,
	  src/beak/Makefile.am, src/beak/beak.h, src/beak/beak_utils.c,
	  src/beak/operate_as.S, src/beak/operate_ia64.S,
	  src/beak/operate_ri_vec.c, src/grid/nl_operator_inc.F90,
	  src/states/states.F90: * I changed how the special code is
	  enabled for compilation. Now it is
	  done mostly by autoconf instead of using the C preprocessor.
	  
	  * I removed the code of the alternative malloc, all the functions
	  should
	  work with unaligned access, but I have to check it.

2009-05-21 17:48  mjv500

	* [r5468] src/states/modelmb_density.F90,
	  src/states/modelmb_density_matrix.F90,
	  src/states/modelmb_exchange_syms.F90,
	  src/system/output_states.F90: generalize antisym to more particle
	  types

2009-05-21 20:21  dstrubbe

	* [r5469] src/sternheimer/Makefile.am, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc.F90,
	  src/sternheimer/em_resp_calc_inc.F90, src/sternheimer/kdotp.F90,
	  src/sternheimer/kdotp_calc.F90,
	  src/sternheimer/kdotp_calc_inc.F90, src/system/pert.F90: *) As
	  Miguel suggested long ago at Mandragora, I added a real version
	  of k.p, making corresponding changes to routines using k.p wfns.
	  *) Added an error message if you try to run k.p on a finite
	  system
	  *) em_resp and k.p report whether they are using real or complex
	  wavefunctions
	  *) push_sub's in pert.F90

2009-05-21 21:08  xavier

	* [r5470] m4/arch.m4: Now sse2 is disabled by default in 32 bit
	  x86.

2009-05-21 21:23  xavier

	* [r5471] src/system/pert.F90: Fixes compilation problem.

2009-05-22 00:34  dstrubbe

	* [r5472] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90,
	  src/hamiltonian/gauge_field.F90, src/hamiltonian/hamiltonian.F90,
	  src/opt_control/check_input.F90, src/sternheimer/em_resp.F90,
	  src/sternheimer/em_resp_calc_inc.F90: *) Some trivial changes to
	  punctuation
	  *) Moved hyperpolarizability message to main routine, where other
	  messages are
	  *) Alphabetized modules in gauge_fields

2009-05-22 00:39  dstrubbe

	* [r5473] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90:
	  Undid two changes to files I didn't mean to commit.

2009-05-22 08:52  marques

	* [r5474] src/hamiltonian/epot_inc.F90, src/species/species.F90: *)
	  In the SP6, please do not put something like "write ()
	  function_call()", as it will likely yiled the error "recursive
	  write"
	  *) The SP6 compiler does not liek some forall

2009-05-22 12:36  xavier

	* [r5475] src/grid/Makefile.am, src/grid/grid.F90,
	  src/grid/multigrid.F90, src/grid/multigrid_inc.F90,
	  src/grid/transfer_table.F90: Now the multigrid transfer tables
	  have their own module.

2009-05-22 15:50  xavier

	* [r5476] src/hamiltonian/projector_inc.F90: More fixes for xlf in
	  the SP6.

2009-05-22 15:58  xavier

	* [r5477] src/grid/multigrid_inc.F90, src/hamiltonian/epot_inc.F90,
	  src/poisson/poisson_multigrid.F90,
	  src/system/preconditioners_inc.F90: Changed the arguments for
	  some multigrid functions.

2009-05-22 17:33  xavier

	* [r5478] src/poisson/poisson_multigrid.F90: A line was too long.

2009-05-22 20:48  xavier

	* [r5479] testsuite/oct-run_regression_test.pl: Now the testsuite
	  uses the standard way of executing MPI jobs. (The
	  standard command is mpiexec and the standard flag for the number
	  of
	  processes is -n .)

2009-05-22 22:47  dstrubbe

	* [r5480] testsuite/periodic_systems/06-h2o_pol_lr.01_gs.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.02_kdotp.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.03_emresp.inp,
	  testsuite/periodic_systems/06-h2o_pol_lr.test,
	  testsuite/periodic_systems/Makefile.am: Added a test for dipole
	  and polarizability of H2O molecule in large supercell. Effective
	  masses and Born effective charges should be coming soon.

2009-05-23 08:06  xavier

	* [r5481] src/grid/mesh_init.F90, src/grid/multigrid_inc.F90,
	  src/system/preconditioners.F90: Now mesh%vol_pp has size 1 if the
	  grid is non-curvilinear. This saves
	  memory and reduces the initialization time of the mesh.

2009-05-23 08:38  xavier

	* [r5482] src/ions/simul_box.F90: A small optimization in
	  simul_box_in_box (with thousands of atoms this
	  thing become important, specially if they are serial).

2009-05-23 09:48  xavier

	* [r5483] src/grid/mesh_init.F90: Improved the way boundary points
	  are partitioned, now it is done
	  faster, using much less memory and it is a bit more balanced.

2009-05-23 16:56  acastro

	* [r5484] src/opt_control/check_input.F90,
	  src/opt_control/opt_control.F90, src/td/Makefile.am,
	  src/td/td_rti.F90, src/td/td_rti_qoct_inc.F90: Added
	  Crank-Nicholson as a possible propagator for the QOCT equation
	  with interacting electrons; it seems to behave better than the
	  only
	  one that was possible before.
	  
	  Since the td_rti.F90 file was growing too large, I separated the
	  QOCT
	  propagators.

2009-05-24 13:09  xavier

	* [r5485] src/poisson/poisson_multigrid.F90: * Multigrid now uses a
	  correction scheme instead of a full
	  approximation scheme.
	  
	  * Bugfix: Some boundary updates were missing in multigrid
	  relaxation,
	  this affected the parallel case.

2009-05-24 14:09  xavier

	* [r5486] src/poisson/poisson.F90,
	  src/poisson/poisson_multigrid.F90, src/system/v_ks.F90: *
	  Modified the default parameters for multigrid.
	  * For iterative solvers, a better starting point is given by
	  using the
	  extrapolated potential.

2009-05-24 16:07  xavier

	* [r5487] src/math/solvers_inc.F90, src/poisson/poisson_cg.F90,
	  src/poisson/poisson_corrections.F90: Optimization and cleaning of
	  the conjugated gradients poisson solver
	  and the poisson correction.

2009-05-25 12:39  marques

	* [r5488] src/basic/profiling.F90, src/grid/mesh_init.F90: A
	  variable was not nullified when using the HyperBox

2009-05-25 17:09  xavier

	* [r5489] src/grid/grid.F90, src/grid/mesh_init.F90: Rearranged
	  some loops to speed up intialization of the mesh.

2009-05-25 18:26  xavier

	* [r5490] src/grid/index.F90, src/grid/mesh.F90,
	  src/grid/mesh_init.F90: Removed Lxyz_tmp and x_tmp.

2009-05-25 20:08  xavier

	* [r5491] src/grid/mesh_init.F90: Now bits are used to mark the
	  points in mesh initialization.

2009-05-25 21:31  xavier

	* [r5492] src/sternheimer/em_resp_calc_inc.F90: This file was
	  taking too long to compile, splitting a function solves
	  the problem.

2009-05-25 23:03  xavier

	* [r5493] src/grid/mesh_init.F90, src/grid/par_vec_inc.F90,
	  src/hamiltonian/projector_inc.F90: * Too long lines were causing
	  compilation with g95 and MPI to fail.

2009-05-26 06:19  sakko

	* [r5494]
	  testsuite/finite_systems_3d/25-multiresolution.01-Hatom.inp,
	  testsuite/finite_systems_3d/25-multiresolution.test,
	  testsuite/finite_systems_3d/Makefile.am: Added a test for
	  multiresolution.

2009-05-26 09:23  marques

	* [r5495] ChangeLog, libxc/ChangeLog, src/basic/profiling.F90,
	  src/grid/mesh_init.F90: *) Added a MemoryLimit variable. Octopus
	  will stop if this variable is set and if the total memory
	  depasses its value
	  *) Octopus was not compiling in 4D due to array mismatches

2009-05-26 09:24  marques

	* [r5496] src/hamiltonian/scf_tol.F90: Forgot debug statement
	  (thanks David)

2009-05-26 10:42  sakko

	* [r5497] src/grid/mesh.F90, src/grid/mesh_init.F90,
	  testsuite/finite_systems_3d/25-multiresolution.test: Implemented
	  a crude method for estimating grid point volumes in
	  multiresolution calculation.

2009-05-26 10:44  xavier

	* [r5498] src/basic/global.F90, src/hamiltonian/epot.F90,
	  src/ions/geometry.F90, src/scf/scf.F90, src/td/td.F90,
	  src/td/td_write.F90: * The interaction of ions with lasers and
	  electric fields had the
	  wrong sign.
	  
	  * Introduced the constant P_PROTON_CHARGE (=-1.0) to mark
	  explicitily where this value should be considered.
	  
	  * Now geometry_dipole returns the charge in atomic units.

2009-05-26 11:56  xavier

	* [r5499] src/basic/profiling.F90, src/grid/basins.F90,
	  src/ions/geometry.F90, src/ions/simul_box.F90, src/main/gcm.F90,
	  src/main/unocc.F90, src/states/restart.F90,
	  src/utils/phonon_spectrum.F90: Fix by Tobias Burns:
	  
	  I found huge(REAL_PRECISION) which of course does not make much
	  sense.
	  That is equivalent to huge(4) (or, equivalently, to huge(8))
	  which
	  returns the largest default-kind integer. I'm pretty sure that
	  the
	  largest 4- or 8-byte real number was intended.
	  
	  I think the cleanest way is to change it to x = huge(x)
	  alternatively
	  one can use huge(M_ONE) or M_HUGE, but I think x < huge(x) is
	  algorithmically cleaner.

2009-05-26 14:29  xavier

	* [r5500] src/grid/mesh.F90, src/main/run.F90,
	  src/states/states.F90: Some fixes to the memory runmode:
	  * For large systems it was giving negative numbers.
	  * It does not generate the ionic potential, so it is faster now.

2009-05-26 16:28  xavier

	* [r5501] src/ions/simul_box.F90: Removed the recursivity in
	  simul_box_end (if there is a memory leak,
	  please fix it in a reasonable way).

2009-05-26 20:04  xavier

	* [r5502] src/basic/profiling.F90: Now the information about
	  throughput and bandwidth are accumulative.

2009-05-26 20:39  xavier

	* [r5503] src/grid/mesh_init.F90: Removed some ' from comments.

2009-05-26 21:50  dstrubbe

	* [r5504] src/ions/geometry.F90, src/scf/scf.F90,
	  testsuite/linear_response/02-h2o_pol_lr.test,
	  testsuite/oct-run_regression_test.pl: *) Made two corrections to
	  Xavier's recent changes to dipoles, to restore the correct
	  behavior. The variable P_PROTON_CHARGE was multiplied twice in
	  the geometry_dipole routine, and the sign of the eventual dipole
	  was reversed.
	  *) Made it so you can set the path for the temporary directories
	  used in the testsuite. With this and the recent change to
	  mpiexec, I now no longer have to edit the testsuite script to run
	  make check on a Cray machine.
	  *) Added a test for dipole moment for H2O as finite system, to
	  detect future alterations to the dipole calculation.

2009-05-26 23:56  dstrubbe

	* [r5505] src/grid/io_function.F90, src/grid/io_function_inc.F90,
	  src/ions/geometry.F90, src/states/states.F90,
	  src/system/Makefile.am, src/system/h_sys_output.F90,
	  src/system/output_h_sys.F90: *) Renamed file output_h_sys to
	  h_sys_output to be consistent with the name of its modules and
	  functions.
	  *) Added many push_sub statements
	  *) Some modifications to variable documentation
	  *) Enabled writing geometry in XSF format, as well as XYZ. Unlike
	  XYZ, XSF includes the lattice vectors and convenient for periodic
	  systems.
	  *) XSF output now correctly uses terms for level of periodicity
	  *) Coordinates in XSF file now are in the units of UnitsOutput.

2009-05-27 00:28  dstrubbe

	* [r5506] src/grid/io_function.F90: Long line shortened.

2009-05-27 08:24  sakko

	* [r5507] src/grid/mesh_init.F90,
	  testsuite/finite_systems_3d/25-multiresolution.test: Improved
	  calculation of grid point resolutions and volumes (in
	  multiresolution).

